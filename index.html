<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç”Ÿç”£ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ï¼ˆå®Œå…¨ç‰ˆï¼šã‚¨ãƒ©ãƒ¼ä¿®æ­£æ¸ˆã¿ï¼‰</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
const { useState, useEffect } = React;




function InventoryManagement() {
  const [activeTab, setActiveTab] = useState('materials');
  const [materials, setMaterials] = useState([]);
  const [orders, setOrders] = useState([]);
  const [searchTerm, setSearchTerm] = useState('');
  const [showAddForm, setShowAddForm] = useState(false);
  const [editingId, setEditingId] = useState(null);
  const [showSettings, setShowSettings] = useState(false);
  const [showFirebaseSetup, setShowFirebaseSetup] = useState(false);
  const [lastSync, setLastSync] = useState(null);
  const [syncStatus, setSyncStatus] = useState('ã‚ªãƒ•ãƒ©ã‚¤ãƒ³');
  const [showPasteArea, setShowPasteArea] = useState(false);
  const [pastedText, setPastedText] = useState('');
  const [isProcessing, setIsProcessing] = useState(false);
  const [firebaseConfig, setFirebaseConfig] = useState({
    apiKey: '',
    authDomain: '',
    databaseURL: '',
    projectId: '',
    storageBucket: '',
    messagingSenderId: '',
    appId: ''
  });
  const [materialForm, setMaterialForm] = useState({
    name: '', code: '', quantity: '', unit: 'kg', location: '', minStock: '', notes: ''
  });
  const [orderForm, setOrderForm] = useState({
    productName: '', customerName: '', quantity: '', unit: 'å€‹', price: '', orderDate: '', deliveryDate: '', status: 'è£½é€ ä¸­', notes: ''
  });
  const [productMaster, setProductMaster] = useState([]);
  const [productMasterForm, setProductMasterForm] = useState({
    productName: '', materialName: '', materialAmount: '', materialUnit: 'kg'
  });
  const [showProductMasterForm, setShowProductMasterForm] = useState(false);
  const [editingProductId, setEditingProductId] = useState(null);
  const [selectedOrders, setSelectedOrders] = useState([]);
  
  // Orders pagination
  const [currentPageOrders, setCurrentPageOrders] = useState(1);
  const [itemsPerPageOrders] = useState(30);
  const [sortByOrders, setSortByOrders] = useState('deliveryDate');
  const [sortOrderOrders, setSortOrderOrders] = useState('asc');
  
  // Materials pagination
  const [currentPageMaterials, setCurrentPageMaterials] = useState(1);
  const [itemsPerPageMaterials] = useState(30);
  const [sortByMaterials, setSortByMaterials] = useState('name');
  const [sortOrderMaterials, setSortOrderMaterials] = useState('asc');


  // FirebaseåˆæœŸåŒ–ãƒã‚§ãƒƒã‚¯
  useEffect(() => {
    const savedConfig = localStorage.getItem('firebase-config');
    if (savedConfig) {
      const config = JSON.parse(savedConfig);
      setFirebaseConfig(config);
      initializeFirebase(config);
    } else {
      // è¨­å®šãŒãªã„å ´åˆã¯ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰èª­ã¿è¾¼ã¿
      loadFromLocalStorage();
    }
  }, []);

  const initializeFirebase = async (config) => {
    try {
      if (!config.databaseURL) {
        setSyncStatus('Firebaseæœªè¨­å®š');
        return;
      }

      setSyncStatus('æ¥ç¶šä¸­...');
      
      // Firebase Realtime Databaseã«æ¥ç¶š
      const dbRef = `${config.databaseURL}/inventory.json`;
      
      // ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
      const response = await fetch(dbRef);
      if (response.ok) {
        const data = await response.json();
        if (data) {
          if (data.materials) setMaterials(data.materials);
          if (data.orders) setOrders(data.orders);
          setLastSync(new Date());
          setSyncStatus('åŒæœŸæ¸ˆã¿');
        } else {
          setSyncStatus('æ¥ç¶šæˆåŠŸï¼ˆãƒ‡ãƒ¼ã‚¿ãªã—ï¼‰');
        }
      } else {
        setSyncStatus('æ¥ç¶šã‚¨ãƒ©ãƒ¼');
      }

      // è‡ªå‹•åŒæœŸã‚’è¨­å®šï¼ˆ10ç§’ã”ã¨ï¼‰
      const interval = setInterval(() => {
        syncFromFirebase(config);
      }, 10000);

      return () => clearInterval(interval);
    } catch (error) {
      console.error('FirebaseåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
      setSyncStatus('æ¥ç¶šã‚¨ãƒ©ãƒ¼');
    }
  };

  const syncFromFirebase = async (config) => {
    try {
      if (!config.databaseURL) return;
      
      const dbRef = `${config.databaseURL}/inventory.json`;
      const response = await fetch(dbRef);
      
      if (response.ok) {
        const data = await response.json();
        if (data) {
          if (data.materials) setMaterials(data.materials);
          if (data.orders) setOrders(data.orders);
          setLastSync(new Date());
          setSyncStatus('åŒæœŸæ¸ˆã¿');
        }
      }
    } catch (error) {
      console.log('åŒæœŸã‚¨ãƒ©ãƒ¼:', error);
      setSyncStatus('åŒæœŸã‚¨ãƒ©ãƒ¼');
    }
  };

  const saveToFirebase = async (materialsData, ordersData) => {
    try {
      console.log('ğŸ’¾ ä¿å­˜é–‹å§‹:', { ææ–™æ•°: materialsData.length, æ³¨æ–‡æ•°: ordersData.length });
      
      // ã¾ãšã€ãƒ­ãƒ¼ã‚«ãƒ«stateã‚’å³åº§ã«æ›´æ–°
      setMaterials(materialsData);
      setOrders(ordersData);
      
      if (!firebaseConfig.databaseURL) {
        // FirebaseãŒè¨­å®šã•ã‚Œã¦ã„ãªã„å ´åˆã¯ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
        localStorage.setItem('materials-list', JSON.stringify(materialsData));
        localStorage.setItem('orders-list', JSON.stringify(ordersData));
        setLastSync(new Date());
        setSyncStatus('ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜');
        console.log('âœ… ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜å®Œäº†');
        return;
      }

      setSyncStatus('ä¿å­˜ä¸­...');
      
      const dbRef = `${firebaseConfig.databaseURL}/inventory.json`;
      const response = await fetch(dbRef, {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          materials: materialsData,
          orders: ordersData,
          lastUpdated: new Date().toISOString()
        })
      });

      if (response.ok) {
        setLastSync(new Date());
        setSyncStatus('åŒæœŸæ¸ˆã¿');
        console.log('âœ… Firebaseä¿å­˜å®Œäº†');
      } else {
        throw new Error('Firebaseä¿å­˜å¤±æ•—');
      }
    } catch (error) {
      console.error('âŒ ä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
      // ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ã‚‚ãƒ­ãƒ¼ã‚«ãƒ«stateã¯æ›´æ–°ã•ã‚Œã¦ã„ã‚‹ã®ã§å•é¡Œãªã—
      // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
      localStorage.setItem('materials-list', JSON.stringify(materialsData));
      localStorage.setItem('orders-list', JSON.stringify(ordersData));
      setSyncStatus('ä¿å­˜ã‚¨ãƒ©ãƒ¼ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜æ¸ˆã¿ï¼‰');
      setLastSync(new Date());
    }
  };

  
  const saveProductMaster = (newProductMaster) => {
    setProductMaster(newProductMaster);
    localStorage.setItem('product-master', JSON.stringify(newProductMaster));
  };

  const checkMaterialStock = (productName, quantity) => {
    const product = productMaster.find(p => 
      productName.toLowerCase().includes(p.productName.toLowerCase()) ||
      p.productName.toLowerCase().includes(productName.toLowerCase())
    );
    
    if (!product) {
      return { hasStock: true, warnings: [], product: null };
    }
    
    const requiredAmount = parseFloat(product.materialAmount) * parseFloat(quantity || 1);
    
    const material = materials.find(m => 
      m.name.toLowerCase().includes(product.materialName.toLowerCase()) ||
      product.materialName.toLowerCase().includes(m.name.toLowerCase())
    );
    
    if (!material) {
      return { 
        hasStock: false, 
        warnings: [`ææ–™ã€Œ${product.materialName}ã€ãŒåœ¨åº«ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“`],
        product: product
      };
    }
    
    const currentStock = parseFloat(material.quantity || 0);
    const shortage = requiredAmount - currentStock;
    
    if (shortage > 0) {
      return {
        hasStock: false,
        warnings: [
          `ææ–™ä¸è¶³: ${product.materialName}`,
          `å¿…è¦: ${requiredAmount.toFixed(2)}${product.materialUnit}`,
          `åœ¨åº«: ${currentStock}${material.unit}`,
          `ä¸è¶³: ${shortage.toFixed(2)}${product.materialUnit}`
        ],
        product: product,
        shortage: shortage
      };
    }
    
    return { hasStock: true, warnings: [], product: product };
  };

  const handleProductMasterAdd = () => {
    if (!productMasterForm.productName || !productMasterForm.materialName || !productMasterForm.materialAmount) {
      alert('è£½å“åã€ææ–™åã€ä½¿ç”¨é‡ã¯å¿…é ˆã§ã™');
      return;
    }
    
    const newProduct = {
      ...productMasterForm,
      id: Date.now(),
      materialAmount: parseFloat(productMasterForm.materialAmount) || 0
    };
    
    saveProductMaster([...productMaster, newProduct]);
    setProductMasterForm({
      productName: '', materialName: '', materialAmount: '', materialUnit: 'kg'
    });
    setShowProductMasterForm(false);
    setEditingProductId(null);
  };

  const handleProductMasterEdit = (product) => {
    setEditingProductId(product.id);
    setProductMasterForm(product);
    setShowProductMasterForm(true);
  };

  const handleProductMasterUpdate = () => {
    const updatedProducts = productMaster.map(p =>
      p.id === editingProductId ? { ...productMasterForm, id: editingProductId, materialAmount: parseFloat(productMasterForm.materialAmount) || 0 } : p
    );
    saveProductMaster(updatedProducts);
    setEditingProductId(null);
    setProductMasterForm({
      productName: '', materialName: '', materialAmount: '', materialUnit: 'kg'
    });
    setShowProductMasterForm(false);
  };

  const handleProductMasterDelete = (id) => {
    const newProducts = productMaster.filter(p => p.id !== id);
    saveProductMaster(newProducts);
    alert('å‰Šé™¤ã—ã¾ã—ãŸ');
  };

const loadFromLocalStorage = () => {
    try {
      const materialsData = localStorage.getItem('materials-list');
      if (materialsData) {
        setMaterials(JSON.parse(materialsData));
      }

      const ordersData = localStorage.getItem('orders-list');
      if (ordersData) {
        setOrders(JSON.parse(ordersData));
      }
      
      setSyncStatus('ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¢ãƒ¼ãƒ‰');
    } catch (error) {
      console.log('ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
    }
  };

  const saveMaterials = (newMaterials) => {
    saveToFirebase(newMaterials, orders);
  };

  const saveOrders = (newOrders) => {
    saveToFirebase(materials, newOrders);
  };

  const saveFirebaseConfig = () => {
    localStorage.setItem('firebase-config', JSON.stringify(firebaseConfig));
    alert('Firebaseè¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦æ¥ç¶šã—ã¾ã™ã€‚');
    setShowFirebaseSetup(false);
    window.location.reload();
  };

  
  
  const processImportedText = (text) => {
    try {
      console.log('========================================');
      console.log('ğŸ“‹ eå•†è²·ãƒ‡ãƒ¼ã‚¿è§£æé–‹å§‹ï¼ˆ3è¡Œæ§‹é€ å¯¾å¿œç‰ˆï¼‰');
      console.log('========================================');
      console.log('æ–‡å­—æ•°:', text.length.toLocaleString());
      
      // Clean up text
      text = text.replace(/é‡ç‚¹/g, '');
      text = text.replace(/å¤‰æ›´/g, '');
      text = text.replace(/æ–°è¦/g, '');
      
      // Split by order number pattern (125OR0012544)
      const orderPattern = /(125OR\d{7})/g;
      const matches = text.match(orderPattern);
      
      if (!matches) {
        alert('æ³¨æ–‡ç•ªå·ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚eå•†è²·ã®å—æ³¨ä¸€è¦§ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„ã€‚');
        console.log('æ³¨æ–‡ç•ªå·ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
        return;
      }
      
      console.log('æ¤œå‡ºã•ã‚ŒãŸæ³¨æ–‡ç•ªå·:', matches.length, 'ä»¶');
      console.log('æ³¨æ–‡ç•ªå·ãƒªã‚¹ãƒˆ:', matches);
      
      const parsedData = [];
      const parts = text.split(orderPattern);
      
      for (let i = 1; i < parts.length; i += 2) {
        const orderNumber = parts[i];
        const content = parts[i + 1] || '';
        
        console.log('\n--- å‡¦ç†ä¸­: ' + orderNumber + ' ---');
        
        // Split into lines
        const lines = content.split('\n').map(line => line.trim()).filter(line => line.length > 0);
        
        if (lines.length < 3) {
          console.log('âš ï¸ ãƒ‡ãƒ¼ã‚¿ãŒä¸å®Œå…¨ã§ã™ï¼ˆ3è¡Œæœªæº€ï¼‰');
          continue;
        }
        
        console.log('è¡Œæ•°:', lines.length);
        
        // Parse line 1: å“ç›®ã‚³ãƒ¼ãƒ‰ã€æ•°é‡ã€å˜ä½ã€ç´æœŸ
        const line1 = lines[0] || '';
        console.log('1è¡Œç›®:', line1);
        
        // å“ç›®ã‚³ãƒ¼ãƒ‰ (HESO...)
        const productCodeMatch = line1.match(/HE[A-Z0-9]+/);
        const productCode = productCodeMatch ? productCodeMatch[0] : '';
        
        // æ•°é‡ã¨å˜ä½ (3,000 å€‹ ã®ã‚ˆã†ãªå½¢å¼)
        const quantityMatch = line1.match(/([\d,]+)\s*(å€‹|ã‚»ãƒƒãƒˆ|æš|æœ¬|kg)/);
        const quantity = quantityMatch ? quantityMatch[1].replace(/,/g, '') : '';
        const unit = quantityMatch ? quantityMatch[2] : 'å€‹';
        
        // ç´æœŸ (26/01/29 ã®ã‚ˆã†ãªå½¢å¼)
        const deliveryDateMatch = line1.match(/(\d{2}\/\d{2}\/\d{2})/);
        const deliveryDate = deliveryDateMatch ? deliveryDateMatch[1] : '';
        
        // Parse line 2: é¡§å®¢åã€è£½å“åã€å—æ³¨æ—¥
        const line2 = lines[1] || '';
        console.log('2è¡Œç›®:', line2);
        
        // é¡§å®¢å (äº‹æ¥­éƒ¨)
        const customerMatch = line2.match(/([^\s]+äº‹æ¥­éƒ¨)/);
        const customerName = customerMatch ? customerMatch[1] : '';
        
        // è£½å“å (HS-1743 ãƒ’ãƒ¼ãƒˆã‚·ãƒ³ã‚¯ ã®ã‚ˆã†ãªå½¢å¼)
        const productNameMatch = line2.match(/(HS-[\d]+[^\t\s]+(?:[^\t]+)?)/);
        const productName = productNameMatch ? productNameMatch[1].trim() : productCode;
        
        // å—æ³¨æ—¥
        const orderDateMatch = line2.match(/(\d{2}\/\d{2}\/\d{2})/);
        const orderDate = orderDateMatch ? orderDateMatch[1] : '';
        
        // Parse line 3: å˜ä¾¡
        const line3 = lines[2] || '';
        console.log('3è¡Œç›®:', line3);
        
        // å˜ä¾¡ (129,000 ã®ã‚ˆã†ãªå½¢å¼ã€JPYã®å¾Œã‚)
        const priceMatch = line3.match(/JPY[\s\t]+([\d,]+)/);
        const price = priceMatch ? priceMatch[1].replace(/,/g, '') : '';
        
        const order = {
          id: Date.now() + Math.random(),
          orderNumber: orderNumber,
          productCode: productCode,
          productName: productName,
          customerName: customerName,
          quantity: quantity,
          unit: unit,
          price: price,
          orderDate: orderDate,
          deliveryDate: deliveryDate,
          status: 'è£½é€ ä¸­',
          notes: ''
        };
        
        console.log('æŠ½å‡ºçµæœ:');
        console.log('  æ³¨æ–‡ç•ªå·:', order.orderNumber);
        console.log('  å“ç›®ã‚³ãƒ¼ãƒ‰:', order.productCode);
        console.log('  è£½å“å:', order.productName);
        console.log('  é¡§å®¢å:', order.customerName);
        console.log('  æ•°é‡:', order.quantity, order.unit);
        console.log('  å˜ä¾¡:', order.price ? 'Â¥' + parseFloat(order.price).toLocaleString() : 'æœªè¨­å®š');
        console.log('  å—æ³¨æ—¥:', order.orderDate);
        console.log('  ç´æœŸ:', order.deliveryDate);
        
        parsedData.push(order);
      }
      
      console.log('');
      console.log('========================================');
      console.log('âœ… è§£æå®Œäº†');
      console.log('========================================');
      console.log('æ¤œå‡ºä»¶æ•°:', parsedData.length, 'ä»¶');
      console.log('');
      
      if (parsedData.length > 0) {
        const newOrders = [...orders, ...parsedData];
        saveOrders(newOrders);
        alert(`${parsedData.length}ä»¶ã®æ³¨æ–‡ã‚’ç™»éŒ²ã—ã¾ã—ãŸï¼\n\nF12ã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§è©³ç´°ã‚’ç¢ºèªã§ãã¾ã™ã€‚`);
        setShowPasteArea(false);
        setPastedText('');
        console.log('âœ… ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜å®Œäº†');
      } else {
        alert('æœ‰åŠ¹ãªãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚F12ã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
      }
    } catch (error) {
      console.error('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error);
      alert('ãƒ‡ãƒ¼ã‚¿ã®è§£æä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚F12ã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
    }
  };

  const handleFileSelect = (event) => {
    const file = event.target.files[0];
    if (!file) {
      console.log('ãƒ•ã‚¡ã‚¤ãƒ«ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“');
      return;
    }

    console.log('ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠæˆåŠŸ:', file.name);
    
    const reader = new FileReader();
    
    reader.onerror = () => {
      alert('ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
    };
    
    reader.onload = (e) => {
      processImportedText(e.target.result);
    };
    
    reader.readAsText(file, 'UTF-8');
    event.target.value = '';
  };

  const handlePasteImport = () => {
    if (!pastedText.trim()) {
      alert('ãƒ†ã‚­ã‚¹ãƒˆã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„');
      return;
    }
    setIsProcessing(true);
    setTimeout(() => {
      processImportedText(pastedText);
      setIsProcessing(false);
    }, 100);
  };

  const processImportedText = (text) => {
    try {
      console.log('========================================');
      console.log('ğŸ“‹ ãƒ‡ãƒ¼ã‚¿è§£æé–‹å§‹');
      console.log('========================================');
      console.log('æ–‡å­—æ•°:', text.length.toLocaleString());
      
      // ã€Œé‡ç‚¹ã€ã€Œå¤‰æ›´ã€ã€Œæ–°è¦ã€ã€Œå‡ºè·æ¸ˆã€ã€Œè£½é€ ä¸­ã€ãªã©ã®ãƒã‚¤ã‚ºã‚’é™¤å»
      text = text.replace(/é‡ç‚¹/g, '');
      text = text.replace(/å¤‰æ›´/g, '');
      text = text.replace(/æ–°è¦/g, '');
      text = text.replace(/å‡ºè·æ¸ˆ/g, '');
      text = text.replace(/è£½é€ ä¸­/g, '');
      text = text.replace(/æ¤œæŸ»ä¸­/g, '');
      text = text.replace(/å‡ºè·æº–å‚™/g, '');
      
      // æ³¨æ–‡ç•ªå·ã§åˆ†å‰²ï¼ˆ125OR0007137ã®ã‚ˆã†ãªãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰
      const orderPattern = /(\d{3}OR\d{7})/g;
      const matches = text.match(orderPattern);
      
      if (!matches) {
        alert('æ³¨æ–‡ç•ªå·ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚ãƒ†ã‚­ã‚¹ãƒˆã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
        console.log('æ³¨æ–‡ç•ªå·ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
        return;
      }
      
      console.log('æ¤œå‡ºã•ã‚ŒãŸæ³¨æ–‡ç•ªå·:', matches.length, 'ä»¶');
      console.log('æ³¨æ–‡ç•ªå·ãƒªã‚¹ãƒˆ:', matches);
      
      const parsedData = [];
      
      // æ³¨æ–‡ç•ªå·ã§åˆ†å‰²
      const parts = text.split(orderPattern);
      
      for (let i = 1; i < parts.length; i += 2) {
        const orderNumber = parts[i];
        const content = parts[i + 1] || '';
        
        console.log('\n--- å‡¦ç†ä¸­: ' + orderNumber + ' ---');
        console.log('ãƒ‡ãƒ¼ã‚¿é•·:', content.length);
        console.log('ãƒ‡ãƒ¼ã‚¿ã®æœ€åˆã®200æ–‡å­—:', content.substring(0, 200));
        
        // è£½å“ã‚³ãƒ¼ãƒ‰ (æ§˜ã€…ãªãƒ‘ã‚¿ãƒ¼ãƒ³ã«å¯¾å¿œ)
        const productCodeMatch = content.match(/([A-Z0-9]{10,})/);
        const productCode = productCodeMatch ? productCodeMatch[0] : '';
        
        // æ•°é‡ã¨å˜ä½ (1,979å€‹ ã‚„ 50å€‹ ãªã©ã«å¯¾å¿œ)
        const quantityMatch = content.match(/([\d,]+)\s*å€‹/);
        const quantity = quantityMatch ? quantityMatch[1].replace(/,/g, '') : '';
        
        // æ—¥ä»˜ (25/10/09ã®ã‚ˆã†ãªãƒ‘ã‚¿ãƒ¼ãƒ³)
        const dateMatches = content.match(/(\d{2}\/\d{2}\/\d{2})/g);
        let deliveryDate = '';
        let orderDate = '';
        
        if (dateMatches && dateMatches.length > 0) {
          deliveryDate = dateMatches[0];
          if (dateMatches.length > 1) {
            orderDate = dateMatches[dateMatches.length - 1];
          }
        }
        
        // é¡§å®¢åï¼ˆäº‹æ¥­éƒ¨ï¼‰
        const customerMatch = content.match(/([^\s]+äº‹æ¥­éƒ¨)/);
        const customerName = customerMatch ? customerMatch[1] : '';
        
        // è£½å“åï¼ˆã‚ˆã‚ŠæŸ”è»Ÿãªãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°ï¼‰
        let productName = productCode;
        
        // ã¾ãšã€äº‹æ¥­éƒ¨ã®å¾Œã«ã‚ã‚‹è£½å“åã‚’æ¢ã™ï¼ˆæœ€ã‚‚æ­£ç¢ºï¼‰
        const afterDepartment = content.split(/äº‹æ¥­éƒ¨/)[1];
        if (afterDepartment) {
          const productNameMatch = afterDepartment.match(/[\s\t]+([^\s\t][^\t]+?)[\s\t]+\d+[\s\t]+è¨ˆç”»/);
          if (productNameMatch) {
            productName = productNameMatch[1].trim();
          } else {
            const simpleMatch = afterDepartment.match(/[\s\t]+([^\s\t].{5,50}?)[\s\t]/);
            if (simpleMatch) {
              productName = simpleMatch[1].trim();
            }
          }
        }
        
        // ã‚‚ã—è£½å“åãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯ã€å†·å´ãƒ•ã‚£ãƒ³ãªã©ã®ä¸€èˆ¬çš„ãªåç§°ã‚’æ¢ã™
        if (productName === productCode) {
          const productNamePatterns = [
            /å†·å´ãƒ•ã‚£ãƒ³[^\t]*/,
            /ï¾šï½²ï½·ï¾”ï½¸[\s]*ï¾Œï½²ï¾[^\t]*/,
            /ï¾Œï½²ï¾[^\t]*/,
            /ãƒ’ãƒ¼ãƒˆã‚·ãƒ³ã‚¯/,
            /ã‚¢ãƒ«ãƒŸæ¿/,
            /ãƒ—ãƒ¬ãƒ¼ãƒˆ/,
            /å…¥åŠ›å›è·¯ãƒ•ã‚£ãƒ³/
          ];
          
          for (const pattern of productNamePatterns) {
            const match = content.match(pattern);
            if (match) {
              productName = match[0].trim();
              break;
            }
          }
        }
        
        // çŠ¶æ…‹
        let status = 'è£½é€ ä¸­';  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚’è£½é€ ä¸­ã«å¤‰æ›´
        if (content.includes('è£½é€ ä¸­')) {
          status = 'è£½é€ ä¸­';
        } else if (content.includes('æ¤œæŸ»ä¸­')) {
          status = 'æ¤œæŸ»ä¸­';
        } else if (content.includes('å‡ºè·æº–å‚™')) {
          status = 'å‡ºè·æº–å‚™';
        } else if (content.includes('å‡ºè·æ¸ˆ')) {
          status = 'å‡ºè·æ¸ˆ';
        }
        
        // å˜ä¾¡ã¯è‡ªå‹•æŠ½å‡ºã—ãªã„ï¼ˆæ‰‹å‹•å…¥åŠ›ã®ã¿ï¼‰
        let price = '';
        
        const order = {
          id: Date.now() + Math.random(),
          orderNumber: orderNumber,
          productCode: productCode,
          productName: productName,
          customerName: customerName,
          quantity: quantity,
          unit: 'å€‹',
          price: price,
          orderDate: orderDate,
          deliveryDate: deliveryDate,
          status: status,
          notes: ''
        };
        
        console.log('æŠ½å‡ºçµæœ:');
        console.log('  æ³¨æ–‡ç•ªå·:', order.orderNumber);
        console.log('  è£½å“ã‚³ãƒ¼ãƒ‰:', order.productCode);
        console.log('  è£½å“å:', order.productName);
        console.log('  é¡§å®¢å:', order.customerName);
        console.log('  æ•°é‡:', order.quantity, order.unit);
        console.log('  å˜ä¾¡:', order.price ? 'Â¥' + parseFloat(order.price).toLocaleString() : 'æ‰‹å‹•å…¥åŠ›ã—ã¦ãã ã•ã„');
        console.log('  ç´æœŸ:', order.deliveryDate);
        console.log('  å—æ³¨æ—¥:', order.orderDate);
        console.log('  çŠ¶æ…‹:', order.status);
        
        parsedData.push(order);
      }
      
      console.log('');
      console.log('========================================');
      console.log('âœ… è§£æå®Œäº†');
      console.log('========================================');
      console.log('æ¤œå‡ºä»¶æ•°:', parsedData.length, 'ä»¶');
      console.log('');
      
      if (parsedData.length > 0) {
        const newOrders = [...orders, ...parsedData];
        saveOrders(newOrders);
        alert(`${parsedData.length}ä»¶ã®æ³¨æ–‡ã‚’ç™»éŒ²ã—ã¾ã—ãŸï¼`);
        setShowPasteArea(false);
        setPastedText('');
        console.log('âœ… ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜å®Œäº†');
      } else {
        alert('æœ‰åŠ¹ãªãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚F12ã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
      }
      
    } catch (error) {
      console.error('ã‚¨ãƒ©ãƒ¼:', error);
      alert('ãƒ‡ãƒ¼ã‚¿ã®å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
    }
  };

  const handleMaterialAdd = () => {
    if (!materialForm.name || !materialForm.quantity) {
      alert('ææ–™åã¨æ•°é‡ã¯å¿…é ˆã§ã™');
      return;
    }
    
    const newMaterial = {
      ...materialForm,
      id: Date.now(),
      quantity: parseFloat(materialForm.quantity) || 0,
      minStock: parseFloat(materialForm.minStock) || 0
    };
    
    saveMaterials([...materials, newMaterial]);
    setMaterialForm({
      name: '', code: '', quantity: '', unit: 'kg', location: '', minStock: '', notes: ''
    });
    setShowAddForm(false);
    setEditingId(null);
  };

  const handleMaterialEdit = (material) => {
    setEditingId(material.id);
    setMaterialForm(material);
    setShowAddForm(true);
  };

  const handleMaterialUpdate = () => {
    const updatedMaterials = materials.map(m =>
      m.id === editingId ? { ...materialForm, id: editingId } : m
    );
    saveMaterials(updatedMaterials);
    setEditingId(null);
    setMaterialForm({
      name: '', code: '', quantity: '', unit: 'kg', location: '', minStock: '', notes: ''
    });
    setShowAddForm(false);
  };

  const handleMaterialDelete = (id) => {
    console.log('å‰Šé™¤ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ - ID:', id);
    console.log('ç¾åœ¨ã®ææ–™æ•°:', materials.length);
    
    const newMaterials = materials.filter(m => m.id !== id);
    console.log('å‰Šé™¤å¾Œã®ææ–™æ•°:', newMaterials.length);
    
    saveMaterials(newMaterials);
    alert('å‰Šé™¤ã—ã¾ã—ãŸ');
  };

  const handleOrderAdd = () => {
    if (!orderForm.productName) {
      alert('è£½å“åã¯å¿…é ˆã§ã™');
      return;
    }
    
    // åœ¨åº«ãƒã‚§ãƒƒã‚¯
    const stockCheck = checkMaterialStock(orderForm.productName, orderForm.quantity);
    
    if (!stockCheck.hasStock && stockCheck.warnings.length > 0) {
      const warningMsg = 'âš ï¸ åœ¨åº«è­¦å‘Š\n\n' + stockCheck.warnings.join('\n') + '\n\nã“ã®ã¾ã¾ç™»éŒ²ã—ã¾ã™ã‹ï¼Ÿ';
      if (!window.confirm(warningMsg)) {
        return;
      }
    }
    
    const newOrder = {
      ...orderForm,
      id: Date.now(),
      quantity: parseFloat(orderForm.quantity) || 0,
      stockWarning: !stockCheck.hasStock
    };
    
    saveOrders([...orders, newOrder]);
    setOrderForm({
      productName: '', customerName: '', quantity: '', unit: 'å€‹', price: '', orderDate: '', deliveryDate: '', status: 'è£½é€ ä¸­', notes: ''
    });
    setShowAddForm(false);
    setEditingId(null);
    
    if (stockCheck.hasStock && stockCheck.product) {
      console.log('âœ… ææ–™åœ¨åº«OK:', stockCheck.product.materialName);
    }
  };

  const handleOrderEdit = (order) => {
    setEditingId(order.id);
    setOrderForm(order);
    setShowAddForm(true);
  };

  const handleOrderUpdate = () => {
    const updatedOrders = orders.map(o =>
      o.id === editingId ? { ...orderForm, id: editingId } : o
    );
    saveOrders(updatedOrders);
    setEditingId(null);
    setOrderForm({
      productName: '', customerName: '', quantity: '', unit: 'å€‹', price: '', orderDate: '', deliveryDate: '', status: 'è£½é€ ä¸­', notes: ''
    });
    setShowAddForm(false);
  };

  const handleOrderDelete = (id) => {
    console.log('========================================');
    console.log('ğŸ—‘ï¸ å‰Šé™¤å‡¦ç†é–‹å§‹');
    console.log('å‰Šé™¤å¯¾è±¡ID:', id);
    console.log('å‰Šé™¤å‰ã®æ³¨æ–‡æ•°:', orders.length);
    console.log('å‰Šé™¤å‰ã®æ³¨æ–‡ä¸€è¦§:', orders.map(o => ({ id: o.id, name: o.productName })));
    
    const newOrders = orders.filter(o => o.id !== id);
    console.log('å‰Šé™¤å¾Œã®æ³¨æ–‡æ•°:', newOrders.length);
    console.log('å‰Šé™¤å¾Œã®æ³¨æ–‡ä¸€è¦§:', newOrders.map(o => ({ id: o.id, name: o.productName })));
    
    console.log('ğŸ’¾ saveOrdersé–¢æ•°ã‚’å‘¼ã³å‡ºã—ã¾ã™...');
    saveOrders(newOrders);
    
    console.log('âœ… å‰Šé™¤å‡¦ç†å®Œäº†');
    console.log('========================================');
    alert('å‰Šé™¤ã—ã¾ã—ãŸ');
  };

  const formatDate = (dateStr) => {
    if (!dateStr) return '-';
    return dateStr;
  };

  const getDeliveryBadge = (deliveryDate, status) => {
    if (status === 'å®Œäº†' || status === 'å‡ºè·æ¸ˆ') {
      return (
        <span className="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
          <span className="inline-block w-5 h-5 text-center">âœ“</span>
          å®Œäº†
        </span>
      );
    }

    if (!deliveryDate) return null;

    const today = new Date();
    today.setHours(0, 0, 0, 0);
    
    const [year, month, day] = deliveryDate.split('/').map(Number);
    const delivery = new Date(2000 + year, month - 1, day);
    
    const diffTime = delivery - today;
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

    if (diffDays < 0) {
      return (
        <span className="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800">
          <span className="inline-block w-5 h-5 text-center">âš ï¸</span>
          ç´æœŸè¶…é
        </span>
      );
    } else if (diffDays <= 3) {
      return (
        <span className="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-800">
          <span className="inline-block w-5 h-5 text-center">â°</span>
          ç´æœŸé–“è¿‘ ({diffDays}æ—¥)
        </span>
      );
    } else if (diffDays <= 7) {
      return (
        <span className="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
          ã‚ã¨{diffDays}æ—¥
        </span>
      );
    } else {
      return (
        <span className="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
          ä½™è£•ã‚ã‚Š
        </span>
      );
    }
  };

  
  // Materials sort functions
  const sortMaterials = (materialsToSort) => {
    return [...materialsToSort].sort((a, b) => {
      let compareA, compareB;
      
      switch (sortByMaterials) {
        case 'name':
          compareA = (a.name || '').toLowerCase();
          compareB = (b.name || '').toLowerCase();
          break;
        case 'code':
          compareA = (a.code || '').toLowerCase();
          compareB = (b.code || '').toLowerCase();
          break;
        case 'quantity':
          compareA = parseFloat(a.quantity) || 0;
          compareB = parseFloat(b.quantity) || 0;
          break;
        case 'location':
          compareA = (a.location || '').toLowerCase();
          compareB = (b.location || '').toLowerCase();
          break;
        case 'stockStatus':
          const statusA = parseFloat(a.quantity) <= parseFloat(a.minStock || 0) ? 0 : 1;
          const statusB = parseFloat(b.quantity) <= parseFloat(b.minStock || 0) ? 0 : 1;
          compareA = statusA;
          compareB = statusB;
          break;
        default:
          compareA = (a.name || '').toLowerCase();
          compareB = (b.name || '').toLowerCase();
      }
      
      if (compareA < compareB) return sortOrderMaterials === 'asc' ? -1 : 1;
      if (compareA > compareB) return sortOrderMaterials === 'asc' ? 1 : -1;
      return 0;
    });
  };

  const handleSortMaterials = (newSortBy) => {
    if (sortByMaterials === newSortBy) {
      setSortOrderMaterials(sortOrderMaterials === 'asc' ? 'desc' : 'asc');
    } else {
      setSortByMaterials(newSortBy);
      setSortOrderMaterials('asc');
    }
    setCurrentPageMaterials(1);
  };

  // Orders sort functions
  const getDeliveryStatusValue = (deliveryDate, status) => {
    if (status === 'å®Œäº†' || status === 'å‡ºè·æ¸ˆ') return 0;
    if (!deliveryDate) return 5;
    
    const today = new Date();
    const delivery = new Date(deliveryDate);
    const daysUntil = Math.ceil((delivery - today) / (1000 * 60 * 60 * 24));
    
    if (daysUntil < 0) return 1;
    if (daysUntil <= 3) return 2;
    if (daysUntil <= 7) return 3;
    return 4;
  };

  const sortOrders = (ordersToSort) => {
    return [...ordersToSort].sort((a, b) => {
      let compareA, compareB;
      
      switch (sortByOrders) {
        case 'orderDate':
          compareA = a.orderDate || '';
          compareB = b.orderDate || '';
          break;
        case 'deliveryDate':
          compareA = a.deliveryDate || '';
          compareB = b.deliveryDate || '';
          break;
        case 'status':
          compareA = a.status || '';
          compareB = b.status || '';
          break;
        case 'deliveryStatus':
          compareA = getDeliveryStatusValue(a.deliveryDate, a.status);
          compareB = getDeliveryStatusValue(b.deliveryDate, b.status);
          break;
        case 'month':
          compareA = a.deliveryDate ? a.deliveryDate.substring(0, 7) : '';
          compareB = b.deliveryDate ? b.deliveryDate.substring(0, 7) : '';
          break;
        default:
          compareA = a.deliveryDate || '';
          compareB = b.deliveryDate || '';
      }
      
      if (compareA < compareB) return sortOrderOrders === 'asc' ? -1 : 1;
      if (compareA > compareB) return sortOrderOrders === 'asc' ? 1 : -1;
      return 0;
    });
  };

  const handleSortOrders = (newSortBy) => {
    if (sortByOrders === newSortBy) {
      setSortOrderOrders(sortOrderOrders === 'asc' ? 'desc' : 'asc');
    } else {
      setSortByOrders(newSortBy);
      setSortOrderOrders('asc');
    }
    setCurrentPageOrders(1);
  };

  // CSV export functions
  const exportToCSV = (data, filename, headers) => {
    // BOM for UTF-8 (Excel compatibility)
    const BOM = '\uFEFF';
    
    // Create CSV header
    let csv = BOM + headers.join(',') + '\n';
    
    // Add data rows
    data.forEach(row => {
      const values = headers.map(header => {
        const key = header.toLowerCase().replace(/\s+/g, '');
        let value = '';
        
        // Map Japanese headers to data keys
        switch(header) {
          case 'ææ–™å': value = row.name || ''; break;
          case 'å“ç•ª': value = row.code || ''; break;
          case 'æ•°é‡': value = row.quantity || ''; break;
          case 'å˜ä½': value = row.unit || ''; break;
          case 'ä¿ç®¡å ´æ‰€': value = row.location || ''; break;
          case 'æœ€ä½åœ¨åº«': value = row.minStock || ''; break;
          case 'å‚™è€ƒ': value = row.notes || ''; break;
          case 'è£½å“å': value = row.productName || ''; break;
          case 'é¡§å®¢å': value = row.customerName || ''; break;
          case 'å˜ä¾¡': value = row.price || ''; break;
          case 'å—æ³¨æ—¥': value = row.orderDate || ''; break;
          case 'ç´æœŸ': value = row.deliveryDate || ''; break;
          case 'çŠ¶æ…‹': value = row.status || ''; break;
          default: value = '';
        }
        
        // Escape commas and quotes
        if (value.includes(',') || value.includes('"') || value.includes('\n')) {
          value = '"' + value.replace(/"/g, '""') + '"';
        }
        
        return value;
      });
      
      csv += values.join(',') + '\n';
    });
    
    // Create download link
    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    const url = URL.createObjectURL(blob);
    
    link.setAttribute('href', url);
    link.setAttribute('download', filename);
    link.style.visibility = 'hidden';
    
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  };

  const handleExportMaterials = () => {
    const today = new Date().toISOString().split('T')[0];
    const filename = `åœ¨åº«ãƒ‡ãƒ¼ã‚¿_${today}.csv`;
    const headers = ['ææ–™å', 'å“ç•ª', 'æ•°é‡', 'å˜ä½', 'ä¿ç®¡å ´æ‰€', 'æœ€ä½åœ¨åº«', 'å‚™è€ƒ'];
    
    exportToCSV(materials, filename, headers);
    alert(`CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ: ${filename}`);
  };

  const handleExportOrders = () => {
    const today = new Date().toISOString().split('T')[0];
    const filename = `ç´æœŸãƒ‡ãƒ¼ã‚¿_${today}.csv`;
    const headers = ['è£½å“å', 'é¡§å®¢å', 'æ•°é‡', 'å˜ä½', 'å˜ä¾¡', 'å—æ³¨æ—¥', 'ç´æœŸ', 'çŠ¶æ…‹', 'å‚™è€ƒ'];
    
    exportToCSV(orders, filename, headers);
    alert(`CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ: ${filename}`);
  };

  const handleExportProductMaster = () => {
    const today = new Date().toISOString().split('T')[0];
    const filename = `è£½å“ãƒã‚¹ã‚¿_${today}.csv`;
    const headers = ['è£½å“å', 'ææ–™å', 'ä½¿ç”¨é‡', 'å˜ä½'];
    
    const data = productMaster.map(p => ({
      productName: p.productName,
      name: p.materialName,
      quantity: p.materialAmount,
      unit: p.materialUnit
    }));
    
    exportToCSV(data, filename, headers);
    alert(`CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ: ${filename}`);
  };

  // Bulk delete functions
  const handleSelectOrder = (orderId) => {
    setSelectedOrders(prev => {
      if (prev.includes(orderId)) {
        return prev.filter(id => id !== orderId);
      } else {
        return [...prev, orderId];
      }
    });
  };

  const handleSelectAllOrders = (checked) => {
    if (checked) {
      setSelectedOrders(paginatedOrders.map(order => order.id));
    } else {
      setSelectedOrders([]);
    }
  };

  const handleBulkDeleteOrders = () => {
    if (selectedOrders.length === 0) {
      alert('å‰Šé™¤ã™ã‚‹æ³¨æ–‡ã‚’é¸æŠã—ã¦ãã ã•ã„');
      return;
    }
    
    const confirmMsg = `é¸æŠã—ãŸ${selectedOrders.length}ä»¶ã®æ³¨æ–‡ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\n\nã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚`;
    if (!window.confirm(confirmMsg)) {
      return;
    }
    
    const newOrders = orders.filter(order => !selectedOrders.includes(order.id));
    saveOrders(newOrders);
    setSelectedOrders([]);
    alert(`${selectedOrders.length}ä»¶ã®æ³¨æ–‡ã‚’å‰Šé™¤ã—ã¾ã—ãŸ`);
  };

  const handleDeleteAllOrders = () => {
    if (orders.length === 0) {
      alert('å‰Šé™¤ã™ã‚‹æ³¨æ–‡ãŒã‚ã‚Šã¾ã›ã‚“');
      return;
    }
    
    const confirmMsg = `å…¨ã¦ã®æ³¨æ–‡ï¼ˆ${orders.length}ä»¶ï¼‰ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\n\nâš ï¸ ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ï¼\n\næœ¬å½“ã«å…¨å‰Šé™¤ã—ã¦ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ`;
    if (!window.confirm(confirmMsg)) {
      return;
    }
    
    // Double confirmation for safety
    const doubleConfirm = window.confirm(`æœ€çµ‚ç¢ºèªï¼š\n\n${orders.length}ä»¶ã®æ³¨æ–‡ã‚’å®Œå…¨ã«å‰Šé™¤ã—ã¾ã™ã€‚\n\nã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ`);
    if (!doubleConfirm) {
      return;
    }
    
    saveOrders([]);
    setSelectedOrders([]);
    alert('å…¨ã¦ã®æ³¨æ–‡ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
  };

  // Clean invalid price data
  const handleCleanPrices = () => {
    const invalidOrders = orders.filter(order => {
      if (!order.price) return false;
      const price = parseFloat(order.price);
      return isNaN(price) || price > 1000000 || price < 0; // Over 1 million or negative
    });
    
    if (invalidOrders.length === 0) {
      alert('ç•°å¸¸ãªå˜ä¾¡ãƒ‡ãƒ¼ã‚¿ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ');
      return;
    }
    
    const confirmMsg = `ç•°å¸¸ãªå˜ä¾¡ãƒ‡ãƒ¼ã‚¿ãŒ${invalidOrders.length}ä»¶è¦‹ã¤ã‹ã‚Šã¾ã—ãŸã€‚\n\n` +
                       `ï¼ˆå˜ä¾¡ãŒ100ä¸‡å††ä»¥ä¸Šã€ã¾ãŸã¯è² ã®å€¤ï¼‰\n\n` +
                       `ã“ã‚Œã‚‰ã®å˜ä¾¡ã‚’ã‚¯ãƒªã‚¢ï¼ˆç©ºæ¬„ã«ï¼‰ã—ã¾ã™ã‹ï¼Ÿ`;
    
    if (!window.confirm(confirmMsg)) {
      return;
    }
    
    const cleanedOrders = orders.map(order => {
      if (!order.price) return order;
      const price = parseFloat(order.price);
      if (isNaN(price) || price > 1000000 || price < 0) {
        return { ...order, price: '' };
      }
      return order;
    });
    
    saveOrders(cleanedOrders);
    alert(`${invalidOrders.length}ä»¶ã®ç•°å¸¸ãªå˜ä¾¡ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ`);
  };

  // Clean all invalid order data
  const handleCleanAllInvalidData = () => {
    if (orders.length === 0) {
      alert('æ³¨æ–‡ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“');
      return;
    }
    
    const invalidOrders = orders.filter(order => {
      // Check for invalid price
      if (order.price && (parseFloat(order.price) > 1000000 || parseFloat(order.price) < 0)) {
        return true;
      }
      // Check for invalid quantity (too large)
      if (order.quantity && parseFloat(order.quantity) > 10000) {
        return true;
      }
      // Check for dates in wrong fields (contains numbers that look like dates in orderDate)
      if (order.orderDate && order.orderDate.length > 20) {
        return true;
      }
      return false;
    });
    
    if (invalidOrders.length === 0) {
      alert('ç•°å¸¸ãªãƒ‡ãƒ¼ã‚¿ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ');
      return;
    }
    
    const confirmMsg = `ç•°å¸¸ãªãƒ‡ãƒ¼ã‚¿ãŒ${invalidOrders.length}ä»¶è¦‹ã¤ã‹ã‚Šã¾ã—ãŸã€‚\n\n` +
                       `ä»¥ä¸‹ã®ã‚ˆã†ãªå•é¡ŒãŒã‚ã‚Šã¾ã™ï¼š\n` +
                       `- ç•°å¸¸ãªå˜ä¾¡ï¼ˆ100ä¸‡å††ä»¥ä¸Šï¼‰\n` +
                       `- ç•°å¸¸ãªæ•°é‡ï¼ˆ1ä¸‡å€‹ä»¥ä¸Šï¼‰\n` +
                       `- å—æ³¨æ—¥ãŒç•°å¸¸ã«é•·ã„\n\n` +
                       `ã“ã‚Œã‚‰ã®æ³¨æ–‡ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`;
    
    if (!window.confirm(confirmMsg)) {
      return;
    }
    
    const cleanedOrders = orders.filter(order => !invalidOrders.find(inv => inv.id === order.id));
    saveOrders(cleanedOrders);
    setSelectedOrders([]);
    alert(`${invalidOrders.length}ä»¶ã®ç•°å¸¸ãªãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸ`);
  };





const filteredMaterials = materials.filter(m =>
    m.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
    (m.code && m.code.toLowerCase().includes(searchTerm.toLowerCase())) ||
    (m.location && m.location.toLowerCase().includes(searchTerm.toLowerCase()))
  );
  
  const sortedMaterials = sortMaterials(filteredMaterials);
  const totalPagesMaterials = Math.ceil(sortedMaterials.length / itemsPerPageMaterials);
  const startIndexMaterials = (currentPageMaterials - 1) * itemsPerPageMaterials;
  const endIndexMaterials = startIndexMaterials + itemsPerPageMaterials;
  const paginatedMaterials = sortedMaterials.slice(startIndexMaterials, endIndexMaterials);

  const filteredOrders = orders.filter(o =>
    o.productName.toLowerCase().includes(searchTerm.toLowerCase()) ||
    (o.customerName && o.customerName.toLowerCase().includes(searchTerm.toLowerCase()))
  );
  
  const sortedOrders = sortOrders(filteredOrders);
  const totalPagesOrders = Math.ceil(sortedOrders.length / itemsPerPageOrders);
  const startIndexOrders = (currentPageOrders - 1) * itemsPerPageOrders;
  const endIndexOrders = startIndexOrders + itemsPerPageOrders;
  const paginatedOrders = sortedOrders.slice(startIndexOrders, endIndexOrders);

  const lowStockItems = materials.filter(m => m.minStock && parseFloat(m.quantity) <= parseFloat(m.minStock));
  const urgentOrders = orders.filter(o => {
    if (o.status === 'å®Œäº†' || o.status === 'å‡ºè·æ¸ˆ' || !o.deliveryDate) return false;
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    const [year, month, day] = o.deliveryDate.split('/').map(Number);
    const delivery = new Date(2000 + year, month - 1, day);
    const diffDays = Math.ceil((delivery - today) / (1000 * 60 * 60 * 24));
    return diffDays <= 3 && diffDays >= 0;
  });

  return (
    <div className="min-h-screen bg-gray-50">
      <div className="bg-gradient-to-r from-blue-600 to-blue-800 text-white shadow-lg">
        <div className="max-w-7xl mx-auto px-4 py-6">
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-3">
              <span className="inline-block w-5 h-5 text-center">ğŸ“¦</span>
              <h1 className="text-3xl font-bold">ç”Ÿç”£ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ï¼ˆã‚¯ãƒ©ã‚¦ãƒ‰ç‰ˆï¼‰</h1>
            </div>
            <div className="flex items-center gap-4">
              <button
                onClick={() => setShowFirebaseSetup(true)}
                className="flex items-center gap-2 px-4 py-2 bg-white bg-opacity-20 rounded-lg hover:bg-opacity-30 transition-colors"
              >
                <span className="inline-block w-5 h-5 text-center">âš™ï¸</span>
                <span className="text-sm">ã‚¯ãƒ©ã‚¦ãƒ‰è¨­å®š</span>
              </button>
              <div className="flex items-center gap-6 text-sm">
                <div className="flex items-center gap-2">
                  <span className="inline-block w-5 h-5 text-center">ğŸ“¦</span>
                  <span>ææ–™: {materials.length}</span>
                </div>
                <div className="flex items-center gap-2">
                  <span className="inline-block w-5 h-5 text-center">ğŸ“…</span>
                  <span>æ³¨æ–‡: {orders.length}</span>
                </div>
                {lowStockItems.length > 0 && (
                  <div className="flex items-center gap-2 bg-yellow-500 px-3 py-1 rounded-full">
                    <span className="inline-block w-5 h-5 text-center">âš ï¸</span>
                    <span className="font-bold">åœ¨åº«è­¦å‘Š: {lowStockItems.length}</span>
                  </div>
                )}
              </div>
              <div className="text-right">
                <div className="text-sm opacity-90">æœ€çµ‚åŒæœŸ</div>
                <div className="text-xs">{lastSync ? lastSync.toLocaleTimeString('ja-JP') : '-'}</div>
              </div>
              <div className={`flex items-center gap-2 px-3 py-1 rounded-full ${
                syncStatus === 'åŒæœŸæ¸ˆã¿' ? 'bg-green-500' :
                syncStatus.includes('ã‚¨ãƒ©ãƒ¼') ? 'bg-red-500' :
                syncStatus === 'ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¢ãƒ¼ãƒ‰' ? 'bg-gray-500' :
                'bg-yellow-500'
              }`}>
                <span className="inline-block w-5 h-5 text-center">â˜ï¸</span>
                <span className="text-sm font-medium">{syncStatus}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div className="max-w-7xl mx-auto px-4 py-6">
        {showFirebaseSetup && (
          <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
            <div className="bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-auto">
              <div className="p-6 border-b bg-blue-50">
                <div className="flex items-center justify-between">
                  <h3 className="text-xl font-bold text-blue-900">Firebaseè¨­å®šï¼ˆã‚¯ãƒ©ã‚¦ãƒ‰å…±æœ‰ï¼‰</h3>
                  <button
                    onClick={() => setShowFirebaseSetup(false)}
                    className="text-gray-500 hover:text-gray-700"
                  >
                    <span className="inline-block w-5 h-5 text-center">âœ•</span>
                  </button>
                </div>
              </div>
              
              <div className="p-6">
                <div className="mb-6 bg-green-50 border border-green-200 rounded-lg p-4">
                  <h4 className="font-bold text-green-900 mb-2">ğŸ”¥ Firebaseã®è¨­å®šæ–¹æ³•</h4>
                  <ol className="text-sm text-green-800 space-y-2 list-decimal list-inside">
                    <li><strong>Firebase Console</strong>ã«ã‚¢ã‚¯ã‚»ã‚¹: <a href="https://console.firebase.google.com" target="_blank" className="text-blue-600 underline">https://console.firebase.google.com</a></li>
                    <li><strong>æ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ</strong>ï¼ˆç„¡æ–™ã§ä½¿ãˆã¾ã™ï¼‰</li>
                    <li>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠ â†’ <strong>Realtime Database</strong> ã‚’ä½œæˆ</li>
                    <li><strong>ãƒ«ãƒ¼ãƒ«ã‚’ç·¨é›†</strong>ã—ã¦ä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´:
                      <pre className="bg-gray-800 text-white p-2 rounded mt-1 text-xs overflow-x-auto">
{`{
  "rules": {
    ".read": true,
    ".write": true
  }
}`}
                      </pre>
                    </li>
                    <li>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š â†’ <strong>Firebase SDK snippet</strong> ã‹ã‚‰è¨­å®šã‚’ã‚³ãƒ”ãƒ¼</li>
                    <li>ä¸‹ã®ãƒ•ã‚©ãƒ¼ãƒ ã«è²¼ã‚Šä»˜ã‘ã¦ä¿å­˜</li>
                  </ol>
                </div>

                <div className="space-y-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">API Key *</label>
                    <input
                      type="text"
                      value={firebaseConfig.apiKey}
                      onChange={(e) => setFirebaseConfig({...firebaseConfig, apiKey: e.target.value})}
                      placeholder="AIzaSyABC..."
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">Database URL * (é‡è¦ï¼)</label>
                    <input
                      type="text"
                      value={firebaseConfig.databaseURL}
                      onChange={(e) => setFirebaseConfig({...firebaseConfig, databaseURL: e.target.value})}
                      placeholder="https://your-project.firebaseio.com"
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">Project ID</label>
                    <input
                      type="text"
                      value={firebaseConfig.projectId}
                      onChange={(e) => setFirebaseConfig({...firebaseConfig, projectId: e.target.value})}
                      placeholder="your-project"
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                    />
                  </div>
                </div>

                <div className="mt-6 flex gap-3">
                  <button
                    onClick={saveFirebaseConfig}
                    className="flex-1 bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 font-bold"
                  >
                    ä¿å­˜ã—ã¦æ¥ç¶š
                  </button>
                  <button
                    onClick={() => setShowFirebaseSetup(false)}
                    className="px-6 py-3 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400"
                  >
                    ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                  </button>
                </div>
              </div>
            </div>
          </div>
        )}

        {showPasteArea && (
          <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 overflow-y-auto">
            <div className="bg-white rounded-lg shadow-xl max-w-4xl w-full my-8">
              <div className="p-6 border-b bg-green-50 sticky top-0">
                <div className="flex items-center justify-between">
                  <h3 className="text-xl font-bold text-green-900">eå•†è²·ãƒ‡ãƒ¼ã‚¿ã‚’è²¼ã‚Šä»˜ã‘</h3>
                  <button
                    onClick={() => {
                      setShowPasteArea(false);
                      setPastedText('');
                    }}
                    className="text-gray-500 hover:text-gray-700"
                  >
                    <span className="inline-block w-5 h-5 text-center">âœ•</span>
                  </button>
                </div>
              </div>
              
              <div className="p-6 max-h-[70vh] overflow-y-auto">
                <div className="mb-4 bg-blue-50 border border-blue-200 rounded-lg p-4">
                  <div className="bg-green-100 border border-green-300 rounded p-3 mb-3">
                    <h4 className="font-bold text-green-900 mb-2">âœ… eå•†è²·ãƒ‡ãƒ¼ã‚¿è§£æãŒæ”¹å–„ã•ã‚Œã¾ã—ãŸï¼</h4>
                    <p className="text-sm text-green-800 mb-2">
                      3è¡Œæ§‹é€ ã®æ­£ã—ã„è§£æã«å¯¾å¿œã—ã¾ã—ãŸã€‚è£½å“åã€é¡§å®¢åã€æ•°é‡ã€å˜ä¾¡ã€ç´æœŸãŒæ­£ç¢ºã«æŠ½å‡ºã•ã‚Œã¾ã™ã€‚
                    </p>
                    <p className="text-sm text-green-800">
                      <strong>æ¨å¥¨ï¼š</strong> ãƒ‡ãƒ¼ã‚¿è²¼ã‚Šä»˜ã‘å¾Œã€F12ã‚­ãƒ¼ã§ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’é–‹ã„ã¦æŠ½å‡ºçµæœã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
                    </p>
                  </div>
                  <h4 className="font-bold text-blue-900 mb-2">ğŸ“‹ æ‰‹é †ï¼š</h4>
                  <ol className="text-sm text-blue-800 space-y-1 list-decimal list-inside">
                    <li>eå•†è²·ã®å—æ³¨ä¸€è¦§ãƒšãƒ¼ã‚¸ã‚’é–‹ã</li>
                    <li>ãƒ‡ãƒ¼ã‚¿ã‚’ãƒã‚¦ã‚¹ã§é¸æŠã—ã¦ã‚³ãƒ”ãƒ¼ï¼ˆCtrl+Cï¼‰</li>
                    <li>ä¸‹ã®ãƒœãƒƒã‚¯ã‚¹ã«è²¼ã‚Šä»˜ã‘ï¼ˆCtrl+Vï¼‰</li>
                    <li>ã€Œâœ“ ç™»éŒ²ã™ã‚‹ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
                    <li>F12ã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§çµæœã‚’ç¢ºèª</li>
                  </ol>
                  <p className="text-xs text-gray-600 mt-2">
                    â€» ãƒ‡ãƒ¼ã‚¿ãŒæ­£ã—ãè§£æã•ã‚Œãªã„å ´åˆã¯ã€æ‰‹å‹•ç™»éŒ²ã‚’ã”åˆ©ç”¨ãã ã•ã„
                  </p>
                </div>

                <textarea
                  value={pastedText}
                  onChange={(e) => setPastedText(e.target.value)}
                  placeholder="ã“ã“ã«eå•†è²·ã®ãƒ‡ãƒ¼ã‚¿ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„..."
                  className="w-full h-64 p-4 border border-gray-300 rounded-lg font-mono text-sm"
                />
              </div>

              <div className="p-6 border-t bg-gray-50 sticky bottom-0">
                <div className="flex gap-3">
                  <button
                    onClick={handlePasteImport}
                    disabled={isProcessing}
                    className="flex-1 px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center justify-center gap-2 disabled:bg-gray-400 font-bold text-lg"
                  >
                    {isProcessing ? (
                      <>
                        <span className="inline-block w-5 h-5 text-center">âŸ³</span>
                        å‡¦ç†ä¸­...
                      </>
                    ) : (
                      <>
                        <span className="inline-block w-5 h-5 text-center">âœ“</span>
                        âœ“ ç™»éŒ²ã™ã‚‹
                      </>
                    )}
                  </button>
                  
                  <button
                    onClick={() => {
                      setShowPasteArea(false);
                      setPastedText('');
                    }}
                    className="px-6 py-3 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors font-bold"
                  >
                    ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                  </button>
                </div>
              </div>
            </div>
          </div>
        )}

        {(lowStockItems.length > 0 || urgentOrders.length > 0) && (
          <div className="space-y-3 mb-6">
            {lowStockItems.length > 0 && (
              <div className="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded">
                <div className="flex items-center">
                  <span className="inline-block w-5 h-5 text-center">âš ï¸</span>
                  <div>
                    <h3 className="font-bold text-yellow-800">åœ¨åº«è­¦å‘Š</h3>
                    <p className="text-yellow-700">
                      {lowStockItems.length}ä»¶ã®ææ–™ãŒæœ€å°åœ¨åº«ã‚’ä¸‹å›ã£ã¦ã„ã¾ã™
                    </p>
                  </div>
                </div>
              </div>
            )}
            {urgentOrders.length > 0 && (
              <div className="bg-red-50 border-l-4 border-red-400 p-4 rounded">
                <div className="flex items-center">
                  <span className="inline-block w-5 h-5 text-center">â°</span>
                  <div>
                    <h3 className="font-bold text-red-800">ç´æœŸè­¦å‘Š</h3>
                    <p className="text-red-700">
                      {urgentOrders.length}ä»¶ã®æ³¨æ–‡ãŒç´æœŸé–“è¿‘ã¾ãŸã¯ç´æœŸåˆ‡ã‚Œã§ã™
                    </p>
                  </div>
                </div>
              </div>
            )}
          </div>
        )}

        <div className="bg-white rounded-lg shadow-md mb-6">
          <div className="border-b border-gray-200">
            <div className="flex">
              <button
                onClick={() => { setActiveTab('materials'); setShowAddForm(false); setSearchTerm(''); }}
                className={`flex-1 px-6 py-4 font-bold text-lg ${
                  activeTab === 'materials'
                    ? 'text-blue-600 border-b-2 border-blue-600 bg-blue-50'
                    : 'text-gray-600 hover:bg-gray-50'
                }`}
              >
                <span className="inline-block w-5 h-5 text-center">ğŸ“¦</span>
                åœ¨åº«ç®¡ç†
              </button>
              <button
                onClick={() => { setActiveTab('orders'); setShowAddForm(false); setSearchTerm(''); }}
                className={`flex-1 px-6 py-4 font-bold text-lg ${
                  activeTab === 'orders'
                    ? 'text-blue-600 border-b-2 border-blue-600 bg-blue-50'
                    : 'text-gray-600 hover:bg-gray-50'
                }`}
              >
                <span className="inline-block w-5 h-5 text-center">ğŸ“…</span>
                ç´æœŸç®¡ç†
              </button>
            </div>
          </div>

          <div className="p-6">
            <div className="flex flex-col md:flex-row gap-4 mb-4">
              <div className="flex-1 relative">
                <span className="inline-block w-5 h-5 text-center">ğŸ”</span>
                <input
                  type="text"
                  placeholder={activeTab === 'materials' ? 'ææ–™åã€å“ç•ªã€ä¿ç®¡å ´æ‰€ã§æ¤œç´¢...' : 'è£½å“åã€é¡§å®¢åã§æ¤œç´¢...'}
                  className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  value={searchTerm}
                  onChange={(e) => setSearchTerm(e.target.value)}
                />
              </div>
              {activeTab !== 'productMaster' && (
                <>
                  <button
                    onClick={() => setShowAddForm(!showAddForm)}
                    className="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 flex items-center justify-center gap-2 font-medium"
                  >
                    <span className="inline-block w-5 h-5 text-center">â•</span>
                    {activeTab === 'materials' ? 'ææ–™ã‚’è¿½åŠ ' : 'æ³¨æ–‡ã‚’è¿½åŠ '}
                  </button>
                  <button
                    onClick={activeTab === 'materials' ? handleExportMaterials : handleExportOrders}
                    className="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 flex items-center justify-center gap-2 font-medium"
                  >
                    <span className="inline-block w-5 h-5 text-center">ğŸ“¥</span>
                    CSVå‡ºåŠ›
                  </button>
                </>
              )}
              {activeTab === 'productMaster' && (
                <>
                  <button
                    onClick={() => setShowProductMasterForm(!showProductMasterForm)}
                    className="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 flex items-center justify-center gap-2 font-medium"
                  >
                    <span className="inline-block w-5 h-5 text-center">â•</span>
                    è£½å“ãƒã‚¹ã‚¿ã‚’è¿½åŠ 
                  </button>
                  <button
                    onClick={handleExportProductMaster}
                    className="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 flex items-center justify-center gap-2 font-medium"
                  >
                    <span className="inline-block w-5 h-5 text-center">ğŸ“¥</span>
                    CSVå‡ºåŠ›
                  </button>
                </>
              )}
            </div>

            {activeTab === 'productMaster' && showProductMasterForm && (
              <div className="bg-gray-50 p-6 rounded-lg mb-6 border-2 border-blue-200">
                <h3 className="text-xl font-bold mb-4 text-gray-800">
                  {editingProductId ? 'è£½å“ãƒã‚¹ã‚¿ã‚’ç·¨é›†' : 'æ–°è¦è£½å“ãƒã‚¹ã‚¿ã‚’è¿½åŠ '}
                </h3>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">
                      è£½å“å <span className="text-red-500">*</span>
                    </label>
                    <input
                      type="text"
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      value={productMasterForm.productName}
                      onChange={(e) => setProductMasterForm({...productMasterForm, productName: e.target.value})}
                      placeholder="ä¾‹: ï¾šï½²ï½·ï¾”ï½¸ ï¾Œï½²ï¾ PF2532"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">
                      ææ–™å <span className="text-red-500">*</span>
                    </label>
                    <input
                      type="text"
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      value={productMasterForm.materialName}
                      onChange={(e) => setProductMasterForm({...productMasterForm, materialName: e.target.value})}
                      placeholder="ä¾‹: A5052"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">
                      ä½¿ç”¨é‡ï¼ˆ1å€‹ã‚ãŸã‚Šï¼‰ <span className="text-red-500">*</span>
                    </label>
                    <input
                      type="number"
                      step="0.01"
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      value={productMasterForm.materialAmount}
                      onChange={(e) => setProductMasterForm({...productMasterForm, materialAmount: e.target.value})}
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">å˜ä½</label>
                    <select
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      value={productMasterForm.materialUnit}
                      onChange={(e) => setProductMasterForm({...productMasterForm, materialUnit: e.target.value})}
                    >
                      <option value="kg">kg</option>
                      <option value="æš">æš</option>
                      <option value="æœ¬">æœ¬</option>
                      <option value="å€‹">å€‹</option>
                      <option value="m">m</option>
                    </select>
                  </div>
                </div>
                <div className="mt-4 flex gap-3">
                  <button
                    onClick={editingProductId ? handleProductMasterUpdate : handleProductMasterAdd}
                    className="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 flex items-center gap-2"
                  >
                    <span className="inline-block w-5 h-5 text-center">ğŸ’¾</span>
                    {editingProductId ? 'æ›´æ–°' : 'è¿½åŠ '}
                  </button>
                  <button
                    onClick={() => {
                      setShowProductMasterForm(false);
                      setEditingProductId(null);
                      setProductMasterForm({
                        productName: '', materialName: '', materialAmount: '', materialUnit: 'kg'
                      });
                    }}
                    className="bg-gray-300 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-400"
                  >
                    ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                  </button>
                </div>
              </div>
            )}

            {activeTab === 'productMaster' && !showProductMasterForm && (
              <div className="bg-white rounded-lg shadow-md overflow-hidden">
                <div className="p-4 bg-gray-100 border-b">
                  <h2 className="text-xl font-bold text-gray-800 flex items-center gap-2">
                    <span className="inline-block w-5 h-5 text-center">ğŸ”—</span>
                    è£½å“ãƒã‚¹ã‚¿ä¸€è¦§ ({productMaster.length}ä»¶)
                  </h2>
                  <p className="text-sm text-gray-600 mt-2">
                    è£½å“ã¨ä½¿ç”¨ææ–™ã‚’ç´ä»˜ã‘ã¦ç™»éŒ²ã—ã¾ã™ã€‚æ³¨æ–‡ç™»éŒ²æ™‚ã«è‡ªå‹•ã§ææ–™åœ¨åº«ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚
                  </p>
                </div>
                
                {productMaster.length === 0 ? (
                  <div className="p-12 text-center text-gray-500">
                    <span className="inline-block w-12 h-12 text-center text-4xl">ğŸ”—</span>
                    <p className="text-lg mt-4">ç™»éŒ²ã•ã‚ŒãŸè£½å“ãƒã‚¹ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>
                    <p className="text-sm mt-2">ã€Œè£½å“ãƒã‚¹ã‚¿ã‚’è¿½åŠ ã€ãƒœã‚¿ãƒ³ã‹ã‚‰ç™»éŒ²ã—ã¦ãã ã•ã„</p>
                  </div>
                ) : (
                  <div className="overflow-x-auto">
                    <table className="w-full">
                      <thead className="bg-gray-50 border-b-2 border-gray-200">
                        <tr>
                          <th className="px-4 py-3 text-center text-sm font-bold text-gray-700">
                            <input
                              type="checkbox"
                              checked={paginatedOrders.length > 0 && paginatedOrders.every(order => selectedOrders.includes(order.id))}
                              onChange={(e) => handleSelectAllOrders(e.target.checked)}
                              className="w-4 h-4 cursor-pointer"
                            />
                          </th>
                          <th className="px-4 py-3 text-left text-sm font-bold text-gray-700">è£½å“å</th>
                          <th className="px-4 py-3 text-left text-sm font-bold text-gray-700">ä½¿ç”¨ææ–™</th>
                          <th className="px-4 py-3 text-right text-sm font-bold text-gray-700">ä½¿ç”¨é‡ï¼ˆ1å€‹ã‚ãŸã‚Šï¼‰</th>
                          <th className="px-4 py-3 text-center text-sm font-bold text-gray-700">æ“ä½œ</th>
                        </tr>
                      </thead>
                      <tbody>
                        {productMaster.map((product, index) => (
                          <tr key={product.id} className={`border-b hover:bg-gray-50 ${index % 2 === 0 ? 'bg-white' : 'bg-gray-25'}`}>
                            <td className="px-4 py-3">
                              <div className="font-medium text-gray-900">{product.productName}</div>
                            </td>
                            <td className="px-4 py-3 text-gray-700">{product.materialName}</td>
                            <td className="px-4 py-3 text-right">
                              <span className="font-bold text-gray-900">{product.materialAmount}</span>
                              <span className="text-gray-600 ml-1">{product.materialUnit}</span>
                            </td>
                            <td className="px-4 py-3">
                              <div className="flex gap-2 justify-center">
                                <button
                                  onClick={() => handleProductMasterEdit(product)}
                                  className="text-blue-600 hover:text-blue-800 p-1"
                                  title="ç·¨é›†"
                                >
                                  âœï¸
                                </button>
                                <button
                                  onClick={() => handleProductMasterDelete(product.id)}
                                  className="text-red-600 hover:text-red-800 p-1"
                                  title="å‰Šé™¤"
                                >
                                  ğŸ—‘ï¸
                                </button>
                              </div>
                            </td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                )}
              </div>
            )}


            {activeTab === 'orders' && !showAddForm && (
              <div className="space-y-3">
                <div className="flex flex-col md:flex-row gap-2">
                  <button
                    onClick={() => setShowPasteArea(true)}
                    className="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 flex items-center justify-center gap-2 font-medium"
                  >
                    <span className="inline-block w-5 h-5 text-center">â¬†ï¸</span>
                    eå•†è²·ãƒ‡ãƒ¼ã‚¿ã‚’ç›´æ¥è²¼ã‚Šä»˜ã‘
                  </button>
                  
                  <label className="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 flex items-center justify-center gap-2 font-medium cursor-pointer">
                    <span className="inline-block w-5 h-5 text-center">â¬†ï¸</span>
                    ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰èª­ã¿è¾¼ã¿
                    <input
                      type="file"
                      accept=".txt,.csv"
                      onChange={handleFileSelect}
                      className="hidden"
                    />
                  </label>
                </div>
                
                {sortedOrders.length > 0 && (
                  <div className="space-y-2">
                    <div className="flex items-center gap-3 p-3 bg-gray-50 border border-gray-200 rounded-lg">
                      <span className="text-sm text-gray-700">
                        {selectedOrders.length > 0 ? (
                          <strong>é¸æŠä¸­: {selectedOrders.length}ä»¶</strong>
                        ) : (
                          <span>æ³¨æ–‡ã‚’é¸æŠã—ã¦ãã ã•ã„</span>
                        )}
                      </span>
                      <div className="flex gap-2 ml-auto">
                        <button
                          onClick={handleBulkDeleteOrders}
                          disabled={selectedOrders.length === 0}
                          className={`px-4 py-2 rounded-lg flex items-center gap-2 font-medium ${
                            selectedOrders.length === 0
                              ? 'bg-gray-300 text-gray-500 cursor-not-allowed'
                              : 'bg-red-600 text-white hover:bg-red-700'
                          }`}
                        >
                          <span className="inline-block w-5 h-5 text-center">ğŸ—‘ï¸</span>
                          é¸æŠå‰Šé™¤
                        </button>
                        <button
                          onClick={handleDeleteAllOrders}
                          className="bg-red-700 text-white px-4 py-2 rounded-lg hover:bg-red-800 flex items-center gap-2 font-medium"
                        >
                          <span className="inline-block w-5 h-5 text-center">ğŸ—‘ï¸</span>
                          å…¨å‰Šé™¤
                        </button>
                      </div>
                    </div>
                    <div className="space-y-2">
                      <div className="flex items-center gap-3 p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
                        <span className="text-sm text-yellow-800">
                          ğŸ’¡ ç•°å¸¸ãªå˜ä¾¡ãƒ‡ãƒ¼ã‚¿ï¼ˆ100ä¸‡å††ä»¥ä¸Šï¼‰ãŒã‚ã‚‹å ´åˆã¯ã‚¯ãƒªã‚¢ã§ãã¾ã™
                        </span>
                        <button
                          onClick={handleCleanPrices}
                          className="bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700 flex items-center gap-2 font-medium ml-auto"
                        >
                          <span className="inline-block w-5 h-5 text-center">ğŸ§¹</span>
                          ç•°å¸¸å˜ä¾¡ã‚’ã‚¯ãƒªã‚¢
                        </button>
                      </div>
                      <div className="flex items-center gap-3 p-3 bg-orange-50 border border-orange-200 rounded-lg">
                        <span className="text-sm text-orange-800">
                          âš ï¸ eå•†è²·ãƒ‡ãƒ¼ã‚¿ã®è§£æã‚¨ãƒ©ãƒ¼ã§ç•°å¸¸ãªãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹å ´åˆã€ä¸€æ‹¬å‰Šé™¤ã§ãã¾ã™
                        </span>
                        <button
                          onClick={handleCleanAllInvalidData}
                          className="bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 flex items-center gap-2 font-medium ml-auto whitespace-nowrap"
                        >
                          <span className="inline-block w-5 h-5 text-center">ğŸ§¹</span>
                          ç•°å¸¸ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤
                        </button>
                      </div>
                    </div>
                  </div>
                )}
              </div>
            )}

            {activeTab === 'materials' && showAddForm && (
              <div className="bg-gray-50 p-6 rounded-lg mb-6 border-2 border-blue-200">
                <h3 className="text-xl font-bold mb-4 text-gray-800">
                  {editingId ? 'ææ–™ã‚’ç·¨é›†' : 'æ–°è¦ææ–™ã‚’è¿½åŠ '}
                </h3>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">
                      ææ–™å <span className="text-red-500">*</span>
                    </label>
                    <input
                      type="text"
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      value={materialForm.name}
                      onChange={(e) => setMaterialForm({...materialForm, name: e.target.value})}
                      placeholder="ä¾‹: A5052 ã‚¢ãƒ«ãƒŸæ¿"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">å“ç•ªãƒ»å‹ç•ª</label>
                    <input
                      type="text"
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      value={materialForm.code}
                      onChange={(e) => setMaterialForm({...materialForm, code: e.target.value})}
                      placeholder="ä¾‹: AL-5052-100"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">
                      æ•°é‡ <span className="text-red-500">*</span>
                    </label>
                    <input
                      type="number"
                      step="0.01"
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      value={materialForm.quantity}
                      onChange={(e) => setMaterialForm({...materialForm, quantity: e.target.value})}
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">å˜ä½</label>
                    <select
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      value={materialForm.unit}
                      onChange={(e) => setMaterialForm({...materialForm, unit: e.target.value})}
                    >
                      <option value="kg">kg</option>
                      <option value="æš">æš</option>
                      <option value="æœ¬">æœ¬</option>
                      <option value="å€‹">å€‹</option>
                      <option value="m">m</option>
                    </select>
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">ä¿ç®¡å ´æ‰€</label>
                    <input
                      type="text"
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      value={materialForm.location}
                      onChange={(e) => setMaterialForm({...materialForm, location: e.target.value})}
                      placeholder="ä¾‹: Aæ£Ÿ-æ£š2-ä¸Šæ®µ"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">æœ€å°åœ¨åº«é‡</label>
                    <input
                      type="number"
                      step="0.01"
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      value={materialForm.minStock}
                      onChange={(e) => setMaterialForm({...materialForm, minStock: e.target.value})}
                    />
                  </div>
                  <div className="md:col-span-2">
                    <label className="block text-sm font-medium text-gray-700 mb-1">å‚™è€ƒ</label>
                    <textarea
                      rows={3}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      value={materialForm.notes}
                      onChange={(e) => setMaterialForm({...materialForm, notes: e.target.value})}
                      placeholder="ãƒ¡ãƒ¢ã‚„è£œè¶³æƒ…å ±"
                    />
                  </div>
                </div>
                <div className="mt-4 flex gap-3">
                  <button
                    onClick={editingId ? handleMaterialUpdate : handleMaterialAdd}
                    className="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 flex items-center gap-2"
                  >
                    <span className="inline-block w-5 h-5 text-center">ğŸ’¾</span>
                    {editingId ? 'æ›´æ–°' : 'è¿½åŠ '}
                  </button>
                  <button
                    onClick={() => {
                      setShowAddForm(false);
                      setEditingId(null);
                      setMaterialForm({
                        name: '', code: '', quantity: '', unit: 'kg', location: '', minStock: '', notes: ''
                      });
                    }}
                    className="bg-gray-300 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-400"
                  >
                    ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                  </button>
                </div>
              </div>
            )}

            {activeTab === 'orders' && showAddForm && (
              <div className="bg-gray-50 p-6 rounded-lg mb-6 border-2 border-blue-200">
                <h3 className="text-xl font-bold mb-4 text-gray-800">
                  {editingId ? 'æ³¨æ–‡ã‚’ç·¨é›†' : 'æ–°è¦æ³¨æ–‡ã‚’è¿½åŠ '}
                </h3>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">
                      è£½å“å <span className="text-red-500">*</span>
                    </label>
                    <input
                      type="text"
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      value={orderForm.productName}
                      onChange={(e) => setOrderForm({...orderForm, productName: e.target.value})}
                      placeholder="ä¾‹: å†·å´ãƒ•ã‚£ãƒ³"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">é¡§å®¢å</label>
                    <input
                      type="text"
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      value={orderForm.customerName}
                      onChange={(e) => setOrderForm({...orderForm, customerName: e.target.value})}
                      placeholder="ä¾‹: â—‹â—‹æ ªå¼ä¼šç¤¾"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">æ•°é‡</label>
                    <input
                      type="number"
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      value={orderForm.quantity}
                      onChange={(e) => setOrderForm({...orderForm, quantity: e.target.value})}
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">å˜ä½</label>
                    <select
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      value={orderForm.unit}
                      onChange={(e) => setOrderForm({...orderForm, unit: e.target.value})}
                    >
                      <option value="å€‹">å€‹</option>
                      <option value="ã‚»ãƒƒãƒˆ">ã‚»ãƒƒãƒˆ</option>
                      <option value="æš">æš</option>
                      <option value="æœ¬">æœ¬</option>
                      <option value="kg">kg</option>
                    </select>
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">å˜ä¾¡ï¼ˆå††ï¼‰</label>
                    <input
                      type="number"
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      value={orderForm.price}
                      onChange={(e) => setOrderForm({...orderForm, price: e.target.value})}
                      placeholder="ä¾‹: 5000"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">å—æ³¨æ—¥</label>
                    <input
                      type="text"
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      value={orderForm.orderDate}
                      onChange={(e) => setOrderForm({...orderForm, orderDate: e.target.value})}
                      placeholder="25/01/20"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">ç´æœŸ</label>
                    <input
                      type="text"
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      value={orderForm.deliveryDate}
                      onChange={(e) => setOrderForm({...orderForm, deliveryDate: e.target.value})}
                      placeholder="25/01/27"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">çŠ¶æ…‹</label>
                    <select
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      value={orderForm.status}
                      onChange={(e) => setOrderForm({...orderForm, status: e.target.value})}
                    >
                      <option value="è£½é€ ä¸­">è£½é€ ä¸­</option>
                      <option value="æ¤œæŸ»ä¸­">æ¤œæŸ»ä¸­</option>
                      <option value="å‡ºè·æº–å‚™">å‡ºè·æº–å‚™</option>
                      <option value="å‡ºè·æ¸ˆ">å‡ºè·æ¸ˆ</option>
                      <option value="å®Œäº†">å®Œäº†</option>
                    </select>
                  </div>
                  <div className="md:col-span-2">
                    <label className="block text-sm font-medium text-gray-700 mb-1">å‚™è€ƒ</label>
                    <textarea
                      rows={3}
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      value={orderForm.notes}
                      onChange={(e) => setOrderForm({...orderForm, notes: e.target.value})}
                      placeholder="ç‰¹è¨˜äº‹é …ã‚„è£œè¶³æƒ…å ±"
                    />
                  </div>
                </div>
                <div className="mt-4 flex gap-3">
                  <button
                    onClick={editingId ? handleOrderUpdate : handleOrderAdd}
                    className="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 flex items-center gap-2"
                  >
                    <span className="inline-block w-5 h-5 text-center">ğŸ’¾</span>
                    {editingId ? 'æ›´æ–°' : 'è¿½åŠ '}
                  </button>
                  <button
                    onClick={() => {
                      setShowAddForm(false);
                      setEditingId(null);
                      setOrderForm({
                        productName: '', customerName: '', quantity: '', unit: 'å€‹', orderDate: '', deliveryDate: '', status: 'è£½é€ ä¸­', notes: ''
                      });
                    }}
                    className="bg-gray-300 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-400"
                  >
                    ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                  </button>
                </div>
              </div>
            )}

            {activeTab === 'materials' && !showAddForm && (
              <div className="bg-white rounded-lg shadow-md overflow-hidden">
                <div className="p-4 bg-gray-100 border-b">
                  <h2 className="text-xl font-bold text-gray-800 flex items-center gap-2">
                    <span className="inline-block w-5 h-5 text-center">ğŸ“¦</span>
                    ææ–™ä¸€è¦§ ({sortedMaterials.length}ä»¶)
                  </h2>
                </div>
                
                {sortedMaterials.length === 0 ? (
                  <div className="p-12 text-center text-gray-500">
                    <span className="inline-block w-5 h-5 text-center">ğŸ“¦</span>
                    <p className="text-lg">ç™»éŒ²ã•ã‚ŒãŸææ–™ãŒã‚ã‚Šã¾ã›ã‚“</p>
                    <p className="text-sm mt-2">ã€Œææ–™ã‚’è¿½åŠ ã€ãƒœã‚¿ãƒ³ã‹ã‚‰ç™»éŒ²ã—ã¦ãã ã•ã„</p>
                  </div>
                ) : (
                  <>
                    {sortedMaterials && sortedMaterials.length > itemsPerPageMaterials && (
                      <div className="mb-4 flex flex-col sm:flex-row items-center justify-between px-4 py-3 bg-gray-50 border rounded-lg gap-3">
                        <div className="text-sm text-gray-700">
                          {startIndexMaterials + 1} - {Math.min(endIndexMaterials, sortedMaterials.length)} ä»¶ / å…¨ {sortedMaterials.length} ä»¶
                        </div>
                        <div className="flex items-center gap-2 flex-wrap justify-center">
                          <button
                            onClick={() => setCurrentPageMaterials(1)}
                            disabled={currentPageMaterials === 1}
                            className={`px-3 py-1 rounded text-sm font-medium ${
                              currentPageMaterials === 1
                                ? 'bg-gray-200 text-gray-400 cursor-not-allowed'
                                : 'bg-blue-600 text-white hover:bg-blue-700'
                            }`}
                          >
                            æœ€åˆ
                          </button>
                          <button
                            onClick={() => setCurrentPageMaterials(currentPageMaterials - 1)}
                            disabled={currentPageMaterials === 1}
                            className={`px-3 py-1 rounded text-sm font-medium ${
                              currentPageMaterials === 1
                                ? 'bg-gray-200 text-gray-400 cursor-not-allowed'
                                : 'bg-blue-600 text-white hover:bg-blue-700'
                            }`}
                          >
                            â† å‰
                          </button>
                          <span className="px-4 py-1 bg-white border rounded text-sm">
                            {currentPageMaterials} / {totalPagesMaterials}
                          </span>
                          <button
                            onClick={() => setCurrentPageMaterials(currentPageMaterials + 1)}
                            disabled={currentPageMaterials === totalPagesMaterials}
                            className={`px-3 py-1 rounded text-sm font-medium ${
                              currentPageMaterials === totalPagesMaterials
                                ? 'bg-gray-200 text-gray-400 cursor-not-allowed'
                                : 'bg-blue-600 text-white hover:bg-blue-700'
                            }`}
                          >
                            æ¬¡ â†’
                          </button>
                          <button
                            onClick={() => setCurrentPageMaterials(totalPagesMaterials)}
                            disabled={currentPageMaterials === totalPagesMaterials}
                            className={`px-3 py-1 rounded text-sm font-medium ${
                              currentPageMaterials === totalPagesMaterials
                                ? 'bg-gray-200 text-gray-400 cursor-not-allowed'
                                : 'bg-blue-600 text-white hover:bg-blue-700'
                            }`}
                          >
                            æœ€å¾Œ
                          </button>
                        </div>
                      </div>
                    )}
                    
                    <div className="overflow-x-auto">
                    <table className="w-full">
                      <thead className="bg-gray-50 border-b-2 border-gray-200">
                        <tr>
                          <th className="px-4 py-3 text-center text-sm font-bold text-gray-700">
                            <button onClick={() => handleSortMaterials('name')} className="hover:text-blue-600 mx-auto block">
                              ææ–™å {sortByMaterials === 'name' && (sortOrderMaterials === 'asc' ? 'â–²' : 'â–¼')}
                            </button>
                          </th>
                          <th className="px-4 py-3 text-center text-sm font-bold text-gray-700">
                            <button onClick={() => handleSortMaterials('code')} className="hover:text-blue-600 mx-auto block">
                              å“ç•ª {sortByMaterials === 'code' && (sortOrderMaterials === 'asc' ? 'â–²' : 'â–¼')}
                            </button>
                          </th>
                          <th className="px-4 py-3 text-center text-sm font-bold text-gray-700">
                            <button onClick={() => handleSortMaterials('quantity')} className="hover:text-blue-600 mx-auto block">
                              æ•°é‡ {sortByMaterials === 'quantity' && (sortOrderMaterials === 'asc' ? 'â–²' : 'â–¼')}
                            </button>
                          </th>
                          <th className="px-4 py-3 text-center text-sm font-bold text-gray-700">
                            <button onClick={() => handleSortMaterials('location')} className="hover:text-blue-600 mx-auto block">
                              ä¿ç®¡å ´æ‰€ {sortByMaterials === 'location' && (sortOrderMaterials === 'asc' ? 'â–²' : 'â–¼')}
                            </button>
                          </th>
                          <th className="px-4 py-3 text-center text-sm font-bold text-gray-700">
                            <button onClick={() => handleSortMaterials('stockStatus')} className="hover:text-blue-600 mx-auto block">
                              çŠ¶æ…‹ {sortByMaterials === 'stockStatus' && (sortOrderMaterials === 'asc' ? 'â–²' : 'â–¼')}
                            </button>
                          </th>
                          <th className="px-4 py-3 text-center text-sm font-bold text-gray-700">æ“ä½œ</th>
                        </tr>
                      </thead>
                      <tbody>
                        {paginatedMaterials.map((material, index) => {
                          const isLowStock = material.minStock && parseFloat(material.quantity) <= parseFloat(material.minStock);
                          return (
                            <tr key={material.id} className={`border-b hover:bg-gray-50 ${index % 2 === 0 ? 'bg-white' : 'bg-gray-25'}`}>
                              <td className="px-4 py-3">
                                <div className="font-medium text-gray-900">{material.name}</div>
                                {material.notes && <div className="text-xs text-gray-500 mt-1">{material.notes}</div>}
                              </td>
                              <td className="px-4 py-3 text-gray-700">{material.code || '-'}</td>
                              <td className="px-4 py-3 text-right">
                                <span className={`font-bold ${isLowStock ? 'text-red-600' : 'text-gray-900'}`}>
                                  {material.quantity}
                                </span>
                                <span className="text-gray-600 ml-1">{material.unit}</span>
                              </td>
                              <td className="px-4 py-3 text-gray-700">{material.location || '-'}</td>
                              <td className="px-4 py-3">
                                {isLowStock ? (
                                  <span className="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800">
                                    <span className="inline-block w-5 h-5 text-center">âš ï¸</span>
                                    åœ¨åº«å°‘
                                  </span>
                                ) : (
                                  <span className="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                    æ­£å¸¸
                                  </span>
                                )}
                              </td>
                              <td className="px-4 py-3">
                                <div className="flex gap-2 justify-center">
                                  <button
                                    onClick={() => handleMaterialEdit(material)}
                                    className="text-blue-600 hover:text-blue-800 p-1"
                                    title="ç·¨é›†"
                                  >
                                    <span className="inline-block w-5 h-5 text-center">âœï¸</span>
                                  </button>
                                  <button
                                    onClick={() => handleMaterialDelete(material.id)}
                                    className="text-red-600 hover:text-red-800 p-1"
                                    title="å‰Šé™¤"
                                  >
                                    <span className="inline-block w-5 h-5 text-center">ğŸ—‘ï¸</span>
                                  </button>
                                </div>
                              </td>
                            </tr>
                          );
                        })}
                      </tbody>
                    </table>
                  </div>
                )}
                
                {sortedMaterials && sortedMaterials.length > itemsPerPageMaterials && (
                  <div className="mt-4 flex flex-col sm:flex-row items-center justify-between px-4 py-3 bg-gray-50 border-t gap-3">
                    <div className="text-sm text-gray-700">
                      {startIndexMaterials + 1} - {Math.min(endIndexMaterials, sortedMaterials.length)} ä»¶ / å…¨ {sortedMaterials.length} ä»¶
                    </div>
                    <div className="flex items-center gap-2 flex-wrap justify-center">
                      <button
                        onClick={() => setCurrentPageMaterials(1)}
                        disabled={currentPageMaterials === 1}
                        className={`px-3 py-1 rounded text-sm font-medium ${
                          currentPageMaterials === 1
                            ? 'bg-gray-200 text-gray-400 cursor-not-allowed'
                            : 'bg-blue-600 text-white hover:bg-blue-700'
                        }`}
                      >
                        æœ€åˆ
                      </button>
                      <button
                        onClick={() => setCurrentPageMaterials(currentPageMaterials - 1)}
                        disabled={currentPageMaterials === 1}
                        className={`px-3 py-1 rounded text-sm font-medium ${
                          currentPageMaterials === 1
                            ? 'bg-gray-200 text-gray-400 cursor-not-allowed'
                            : 'bg-blue-600 text-white hover:bg-blue-700'
                        }`}
                      >
                        â† å‰
                      </button>
                      <span className="px-4 py-1 bg-white border rounded text-sm">
                        {currentPageMaterials} / {totalPagesMaterials}
                      </span>
                      <button
                        onClick={() => setCurrentPageMaterials(currentPageMaterials + 1)}
                        disabled={currentPageMaterials === totalPagesMaterials}
                        className={`px-3 py-1 rounded text-sm font-medium ${
                          currentPageMaterials === totalPagesMaterials
                            ? 'bg-gray-200 text-gray-400 cursor-not-allowed'
                            : 'bg-blue-600 text-white hover:bg-blue-700'
                        }`}
                      >
                        æ¬¡ â†’
                      </button>
                      <button
                        onClick={() => setCurrentPageMaterials(totalPagesMaterials)}
                        disabled={currentPageMaterials === totalPagesMaterials}
                        className={`px-3 py-1 rounded text-sm font-medium ${
                          currentPageMaterials === totalPagesMaterials
                            ? 'bg-gray-200 text-gray-400 cursor-not-allowed'
                            : 'bg-blue-600 text-white hover:bg-blue-700'
                        }`}
                      >
                        æœ€å¾Œ
                      </button>
                    </div>
                  </div>
                )}
                  </>
                )}
              </div>
            )}

            {activeTab === 'orders' && !showAddForm && (

              <div className="bg-white rounded-lg shadow-md overflow-hidden">
                <div className="p-4 bg-gray-100 border-b">
                  <h2 className="text-xl font-bold text-gray-800 flex items-center gap-2">
                    <span className="inline-block w-5 h-5 text-center">ğŸ“…</span>
                    æ³¨æ–‡ä¸€è¦§ ({sortedOrders.length}ä»¶)
                  </h2>
                </div>
                
                {sortedOrders.length === 0 ? (
                  <div className="p-12 text-center text-gray-500">
                    <span className="inline-block w-5 h-5 text-center">ğŸ“…</span>
                    <p className="text-lg">ç™»éŒ²ã•ã‚ŒãŸæ³¨æ–‡ãŒã‚ã‚Šã¾ã›ã‚“</p>
                    <p className="text-sm mt-2">ã€Œæ³¨æ–‡ã‚’è¿½åŠ ã€ãƒœã‚¿ãƒ³ã¾ãŸã¯ã€Œeå•†è²·ãƒ‡ãƒ¼ã‚¿ã‚’ç›´æ¥è²¼ã‚Šä»˜ã‘ã€ã‹ã‚‰ç™»éŒ²ã—ã¦ãã ã•ã„</p>
                  </div>
                ) : (
                  <>
                    {sortedOrders && sortedOrders.length > itemsPerPageOrders && (
                      <div className="mb-4 flex flex-col sm:flex-row items-center justify-between px-4 py-3 bg-gray-50 border rounded-lg gap-3">
                        <div className="text-sm text-gray-700">
                          {startIndexOrders + 1} - {Math.min(endIndexOrders, sortedOrders.length)} ä»¶ / å…¨ {sortedOrders.length} ä»¶
                        </div>
                        <div className="flex items-center gap-2 flex-wrap justify-center">
                          <button
                            onClick={() => setCurrentPageOrders(1)}
                            disabled={currentPageOrders === 1}
                            className={`px-3 py-1 rounded text-sm font-medium ${
                              currentPageOrders === 1
                                ? 'bg-gray-200 text-gray-400 cursor-not-allowed'
                                : 'bg-blue-600 text-white hover:bg-blue-700'
                            }`}
                          >
                            æœ€åˆ
                          </button>
                          <button
                            onClick={() => setCurrentPageOrders(currentPageOrders - 1)}
                            disabled={currentPageOrders === 1}
                            className={`px-3 py-1 rounded text-sm font-medium ${
                              currentPageOrders === 1
                                ? 'bg-gray-200 text-gray-400 cursor-not-allowed'
                                : 'bg-blue-600 text-white hover:bg-blue-700'
                            }`}
                          >
                            â† å‰
                          </button>
                          <span className="px-4 py-1 bg-white border rounded text-sm">
                            {currentPageOrders} / {totalPagesOrders}
                          </span>
                          <button
                            onClick={() => setCurrentPageOrders(currentPageOrders + 1)}
                            disabled={currentPageOrders === totalPagesOrders}
                            className={`px-3 py-1 rounded text-sm font-medium ${
                              currentPageOrders === totalPagesOrders
                                ? 'bg-gray-200 text-gray-400 cursor-not-allowed'
                                : 'bg-blue-600 text-white hover:bg-blue-700'
                            }`}
                          >
                            æ¬¡ â†’
                          </button>
                          <button
                            onClick={() => setCurrentPageOrders(totalPagesOrders)}
                            disabled={currentPageOrders === totalPagesOrders}
                            className={`px-3 py-1 rounded text-sm font-medium ${
                              currentPageOrders === totalPagesOrders
                                ? 'bg-gray-200 text-gray-400 cursor-not-allowed'
                                : 'bg-blue-600 text-white hover:bg-blue-700'
                            }`}
                          >
                            æœ€å¾Œ
                          </button>
                        </div>
                      </div>
                    )}
                    
                    <div className="overflow-x-auto">
                    <table className="w-full">
                      <thead className="bg-gray-50 border-b-2 border-gray-200">
                        <tr>
                          <th className="px-4 py-3 text-left text-sm font-bold text-gray-700">è£½å“å</th>
                          <th className="px-4 py-3 text-left text-sm font-bold text-gray-700">é¡§å®¢å</th>
                          <th className="px-4 py-3 text-right text-sm font-bold text-gray-700">æ•°é‡</th>
                          <th className="px-4 py-3 text-right text-sm font-bold text-gray-700">å˜ä¾¡</th>
                          <th className="px-4 py-3 text-center text-sm font-bold text-gray-700">
                            <button onClick={() => handleSortOrders('orderDate')} className="hover:text-blue-600 mx-auto block">
                              å—æ³¨æ—¥ {sortByOrders === 'orderDate' && (sortOrderOrders === 'asc' ? 'â–²' : 'â–¼')}
                            </button>
                          </th>
                          <th className="px-4 py-3 text-center text-sm font-bold text-gray-700">
                            <button onClick={() => handleSortOrders('deliveryDate')} className="hover:text-blue-600 mx-auto block">
                              ç´æœŸ {sortByOrders === 'deliveryDate' && (sortOrderOrders === 'asc' ? 'â–²' : 'â–¼')}
                            </button>
                          </th>
                          <th className="px-4 py-3 text-center text-sm font-bold text-gray-700">
                            <button onClick={() => handleSortOrders('status')} className="hover:text-blue-600 mx-auto block">
                              çŠ¶æ…‹ {sortByOrders === 'status' && (sortOrderOrders === 'asc' ? 'â–²' : 'â–¼')}
                            </button>
                          </th>
                          <th className="px-4 py-3 text-center text-sm font-bold text-gray-700">
                            <button onClick={() => handleSortOrders('deliveryStatus')} className="hover:text-blue-600 mx-auto block">
                              ç´æœŸçŠ¶æ³ {sortByOrders === 'deliveryStatus' && (sortOrderOrders === 'asc' ? 'â–²' : 'â–¼')}
                            </button>
                          </th>
                          <th className="px-4 py-3 text-center text-sm font-bold text-gray-700">æ“ä½œ</th>
                        </tr>
                      </thead>
                      <tbody>
                        {paginatedOrders.map((order, index) => (
                          <tr key={order.id} className={`border-b hover:bg-gray-50 ${order.stockWarning ? 'bg-red-50' : (index % 2 === 0 ? 'bg-white' : 'bg-gray-25')}`}>
                            <td className="px-4 py-3 text-center">
                              <input
                                type="checkbox"
                                checked={selectedOrders.includes(order.id)}
                                onChange={() => handleSelectOrder(order.id)}
                                className="w-4 h-4 cursor-pointer"
                              />
                            </td>
                            <td className="px-4 py-3">
                              <div className="flex items-center gap-2">
                                {order.stockWarning && (
                                  <span className="text-red-600" title="ææ–™åœ¨åº«ä¸è¶³">âš ï¸</span>
                                )}
                                <div className="font-medium text-gray-900">{order.productName}</div>
                              </div>
                              {order.notes && <div className="text-xs text-gray-500 mt-1">{order.notes}</div>}
                            </td>
                            <td className="px-4 py-3 text-gray-700">{order.customerName || '-'}</td>
                            <td className="px-4 py-3 text-right">
                              <span className="font-bold text-gray-900">{order.quantity || '-'}</span>
                              {order.quantity && <span className="text-gray-600 ml-1">{order.unit}</span>}
                            </td>
                            <td className="px-4 py-3 text-right text-gray-700">
                              {order.price ? `Â¥${parseFloat(order.price).toLocaleString()}` : '-'}
                            </td>
                            <td className="px-4 py-3 text-gray-700">{formatDate(order.orderDate)}</td>
                            <td className="px-4 py-3 text-gray-900 font-medium">{formatDate(order.deliveryDate)}</td>
                            <td className="px-4 py-3">
                              <span className={`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${
                                order.status === 'å®Œäº†' ? 'bg-gray-100 text-gray-800' :
                                order.status === 'å‡ºè·æº–å‚™' ? 'bg-blue-100 text-blue-800' :
                                order.status === 'æ¤œæŸ»ä¸­' ? 'bg-purple-100 text-purple-800' :
                                order.status === 'è£½é€ ä¸­' ? 'bg-yellow-100 text-yellow-800' :
                                'bg-green-100 text-green-800'
                              }`}>
                                {order.status}
                              </span>
                            </td>
                            <td className="px-4 py-3">
                              {getDeliveryBadge(order.deliveryDate, order.status)}
                            </td>
                            <td className="px-4 py-3">
                              <div className="flex gap-2 justify-center">
                                <button
                                  onClick={() => handleOrderEdit(order)}
                                  className="text-blue-600 hover:text-blue-800 p-1"
                                  title="ç·¨é›†"
                                >
                                  <span className="inline-block w-5 h-5 text-center">âœï¸</span>
                                </button>
                                <button
                                  onClick={() => handleOrderDelete(order.id)}
                                  className="text-red-600 hover:text-red-800 p-1"
                                  title="å‰Šé™¤"
                                >
                                  <span className="inline-block w-5 h-5 text-center">ğŸ—‘ï¸</span>
                                </button>
                              </div>
                            </td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                )}
                
                {sortedOrders && sortedOrders.length > itemsPerPageOrders && (
                  <div className="mt-4 flex flex-col sm:flex-row items-center justify-between px-4 py-3 bg-gray-50 border-t gap-3">
                    <div className="text-sm text-gray-700">
                      {startIndexOrders + 1} - {Math.min(endIndexOrders, sortedOrders.length)} ä»¶ / å…¨ {sortedOrders.length} ä»¶
                    </div>
                    <div className="flex items-center gap-2 flex-wrap justify-center">
                      <button
                        onClick={() => setCurrentPageOrders(1)}
                        disabled={currentPageOrders === 1}
                        className={`px-3 py-1 rounded text-sm font-medium ${
                          currentPageOrders === 1
                            ? 'bg-gray-200 text-gray-400 cursor-not-allowed'
                            : 'bg-blue-600 text-white hover:bg-blue-700'
                        }`}
                      >
                        æœ€åˆ
                      </button>
                      <button
                        onClick={() => setCurrentPageOrders(currentPageOrders - 1)}
                        disabled={currentPageOrders === 1}
                        className={`px-3 py-1 rounded text-sm font-medium ${
                          currentPageOrders === 1
                            ? 'bg-gray-200 text-gray-400 cursor-not-allowed'
                            : 'bg-blue-600 text-white hover:bg-blue-700'
                        }`}
                      >
                        â† å‰
                      </button>
                      <span className="px-4 py-1 bg-white border rounded text-sm">
                        {currentPageOrders} / {totalPagesOrders}
                      </span>
                      <button
                        onClick={() => setCurrentPageOrders(currentPageOrders + 1)}
                        disabled={currentPageOrders === totalPagesOrders}
                        className={`px-3 py-1 rounded text-sm font-medium ${
                          currentPageOrders === totalPagesOrders
                            ? 'bg-gray-200 text-gray-400 cursor-not-allowed'
                            : 'bg-blue-600 text-white hover:bg-blue-700'
                        }`}
                      >
                        æ¬¡ â†’
                      </button>
                      <button
                        onClick={() => setCurrentPageOrders(totalPagesOrders)}
                        disabled={currentPageOrders === totalPagesOrders}
                        className={`px-3 py-1 rounded text-sm font-medium ${
                          currentPageOrders === totalPagesOrders
                            ? 'bg-gray-200 text-gray-400 cursor-not-allowed'
                            : 'bg-blue-600 text-white hover:bg-blue-700'
                        }`}
                      >
                        æœ€å¾Œ
                      </button>
                    </div>
                  </div>
                )}
                  </>
                )}
              </div>
            )}
          </div>
        </div>

        <div className="mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4">
          <h3 className="font-bold text-blue-900 mb-2 flex items-center gap-2">
            <span className="inline-block w-5 h-5 text-center">â˜ï¸</span>
            ã‚¯ãƒ©ã‚¦ãƒ‰å…±æœ‰ã«ã¤ã„ã¦
          </h3>
          <ul className="text-sm text-blue-800 space-y-1">
            <li>â€¢ <strong>Firebaseè¨­å®šå¾Œ:</strong> å…¨ãƒ‡ãƒã‚¤ã‚¹ã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸã•ã‚Œã¾ã™</li>
            <li>â€¢ <strong>å¯¾å¿œãƒ‡ãƒã‚¤ã‚¹:</strong> Macã€Windowsã€iPhoneã€Androidã€iPad ã™ã¹ã¦OK</li>
            <li>â€¢ <strong>è¤‡æ•°äººã§å…±æœ‰:</strong> åŒã˜Firebaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½¿ãˆã°5äººã§ã‚‚10äººã§ã‚‚å…±æœ‰å¯èƒ½</li>
            <li>â€¢ <strong>è¨­å®šå‰:</strong> ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¢ãƒ¼ãƒ‰ã§å‹•ä½œï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã®ã¿ã§ä¿å­˜ï¼‰</li>
          </ul>
        </div>

        <div className="mt-4 bg-green-50 border border-green-200 rounded-lg p-4">
          <h3 className="font-bold text-green-900 mb-2 flex items-center gap-2">
            <span className="inline-block w-5 h-5 text-center">â¬†ï¸</span>
            eå•†è²·ãƒ‡ãƒ¼ã‚¿ã®ä¸€æ‹¬ç™»éŒ²
          </h3>
          <p className="text-sm text-green-800">
            ç´æœŸç®¡ç†ã‚¿ãƒ–ã‹ã‚‰ã€Œeå•†è²·ãƒ‡ãƒ¼ã‚¿ã‚’ç›´æ¥è²¼ã‚Šä»˜ã‘ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’ç™»éŒ²ã§ãã¾ã™ã€‚
          </p>
        </div>
      </div>
    </div>
  );
}

// Render the app
const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<InventoryManagement />);
  </script>
</body>
</html>
