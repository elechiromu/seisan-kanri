import React, { useState, useEffect } from 'react';
import { Plus, Search, Package, AlertCircle, Edit2, Trash2, Save, X, Calendar, Clock, CheckCircle, Users, Bell, Mail, RefreshCw, Cloud, Upload } from 'lucide-react';

export default function InventoryManagement() {
  const [activeTab, setActiveTab] = useState('materials');
  const [materials, setMaterials] = useState([]);
  const [orders, setOrders] = useState([]);
  const [searchTerm, setSearchTerm] = useState('');
  const [showAddForm, setShowAddForm] = useState(false);
  const [editingId, setEditingId] = useState(null);
  const [showSettings, setShowSettings] = useState(false);
  const [userEmail, setUserEmail] = useState('');
  const [notificationEmails, setNotificationEmails] = useState([]);
  const [newEmail, setNewEmail] = useState('');
  const [lastSync, setLastSync] = useState(null);
  const [syncStatus, setSyncStatus] = useState('åŒæœŸæ¸ˆã¿');
  const [showImportModal, setShowImportModal] = useState(false);
  const [csvPreviewData, setCsvPreviewData] = useState([]);
  const [showPasteArea, setShowPasteArea] = useState(false);
  const [pastedText, setPastedText] = useState('');
  const [isProcessing, setIsProcessing] = useState(false);
  const [materialForm, setMaterialForm] = useState({
    name: '', code: '', quantity: '', unit: 'kg', location: '', minStock: '', notes: ''
  });
  const [orderForm, setOrderForm] = useState({
    productName: '', customerName: '', quantity: '', unit: 'å€‹', orderDate: '', deliveryDate: '', status: 'è£½é€ ä¸­', notes: ''
  });

  useEffect(() => {
    loadData();
    loadSettings();
    
    const interval = setInterval(() => {
      loadData();
    }, 10000);
    
    return () => clearInterval(interval);
  }, []);

  const loadData = async () => {
    try {
      setSyncStatus('åŒæœŸä¸­...');
      
      const materialsResult = await window.storage.get('materials-list', true);
      if (materialsResult) {
        setMaterials(JSON.parse(materialsResult.value));
      }

      const ordersResult = await window.storage.get('orders-list', true);
      if (ordersResult) {
        setOrders(JSON.parse(ordersResult.value));
      }
      
      setLastSync(new Date());
      setSyncStatus('åŒæœŸæ¸ˆã¿');
    } catch (error) {
      console.log('ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿:', error);
      setSyncStatus('åŒæœŸã‚¨ãƒ©ãƒ¼');
    }
  };

  const loadSettings = async () => {
    try {
      const emailResult = await window.storage.get('user-email', false);
      if (emailResult) {
        setUserEmail(emailResult.value);
      }
    } catch (error) {
      console.log('ãƒ¡ãƒ¼ãƒ«è¨­å®šãªã—');
    }

    try {
      const notifResult = await window.storage.get('notification-emails', true);
      if (notifResult) {
        setNotificationEmails(JSON.parse(notifResult.value));
      }
    } catch (error) {
      setNotificationEmails([]);
    }
  };

  const saveMaterials = async (newMaterials) => {
    try {
      setSyncStatus('ä¿å­˜ä¸­...');
      await window.storage.set('materials-list', JSON.stringify(newMaterials), true);
      setMaterials(newMaterials);
      setLastSync(new Date());
      setSyncStatus('åŒæœŸæ¸ˆã¿');
    } catch (error) {
      alert('ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ');
      setSyncStatus('ä¿å­˜ã‚¨ãƒ©ãƒ¼');
    }
  };

  const saveOrders = async (newOrders) => {
    try {
      setSyncStatus('ä¿å­˜ä¸­...');
      await window.storage.set('orders-list', JSON.stringify(newOrders), true);
      setOrders(newOrders);
      setLastSync(new Date());
      setSyncStatus('åŒæœŸæ¸ˆã¿');
    } catch (error) {
      alert('ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ');
      setSyncStatus('ä¿å­˜ã‚¨ãƒ©ãƒ¼');
    }
  };

  const saveSettings = async () => {
    try {
      await window.storage.set('user-email', userEmail, false);
      await window.storage.set('notification-emails', JSON.stringify(notificationEmails), true);
      alert('è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ');
      setShowSettings(false);
    } catch (error) {
      alert('ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ');
    }
  };

  const addNotificationEmail = () => {
    if (newEmail && !notificationEmails.includes(newEmail)) {
      setNotificationEmails([...notificationEmails, newEmail]);
      setNewEmail('');
    }
  };

  const removeNotificationEmail = (email) => {
    setNotificationEmails(notificationEmails.filter(e => e !== email));
  };

  const handleFileSelect = (event) => {
    const file = event.target.files[0];
    if (!file) {
      console.log('ãƒ•ã‚¡ã‚¤ãƒ«ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“');
      return;
    }

    console.log('ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠæˆåŠŸ:', file.name);
    
    const reader = new FileReader();
    
    reader.onerror = () => {
      alert('ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
    };
    
    reader.onload = (e) => {
      processImportedText(e.target.result);
    };
    
    reader.readAsText(file, 'UTF-8');
    event.target.value = '';
  };

  const handlePasteImport = () => {
    if (!pastedText.trim()) {
      alert('ãƒ†ã‚­ã‚¹ãƒˆã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„');
      return;
    }
    console.log('è²¼ã‚Šä»˜ã‘ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯');
    setIsProcessing(true);
    setTimeout(() => {
      processImportedText(pastedText);
      setIsProcessing(false);
    }, 100);
  };

  const processImportedText = (text) => {
    try {
      console.log('========================================');
      console.log('ğŸ“‹ ãƒ‡ãƒ¼ã‚¿è§£æé–‹å§‹');
      console.log('========================================');
      console.log('æ–‡å­—æ•°:', text.length.toLocaleString());
      
      // å…¨ã¦ã®è¡Œã‚’é…åˆ—ã«ã™ã‚‹
      const lines = text.split('\n').map(line => line.trim());
      console.log('ç·è¡Œæ•°:', lines.length);
      console.log('');
      
      const parsedData = [];
      let currentOrder = {};
      let lineIndex = 0;
      
      // å„è¡Œã‚’é †ç•ªã«å‡¦ç†
      for (let i = 0; i < lines.length; i++) {
        const line = lines[i];
        
        // ç©ºè¡Œã¨çŸ­ã„è¡Œã¯ã‚¹ã‚­ãƒƒãƒ—
        if (!line || line.length < 2) continue;
        
        // ãƒ‡ãƒãƒƒã‚°: æœ€åˆã®10è¡Œã ã‘è©³ç´°è¡¨ç¤º
        if (i < 10) {
          console.log(`è¡Œ${i}: "${line}"`);
        }
        
        // æ³¨æ–‡ç•ªå·ã‚’æ¤œå‡ºï¼ˆä¾‹: 125OR0007137ï¼‰
        if (line.match(/\d{3}OR\d{7}/)) {
          // å‰ã®æ³¨æ–‡ãŒã‚ã‚Œã°ä¿å­˜
          if (currentOrder.orderNumber && currentOrder.productName && currentOrder.quantity) {
            parsedData.push({...currentOrder});
            console.log('âœ… æ³¨æ–‡ã‚’ä¿å­˜:', currentOrder.orderNumber);
          }
          // æ–°ã—ã„æ³¨æ–‡ã‚’é–‹å§‹
          currentOrder = { 
            orderNumber: line,
            status: 'å—æ³¨'
          };
          console.log('');
          console.log('ğŸ†• æ–°ã—ã„æ³¨æ–‡:', line);
          lineIndex = i;
          continue;
        }
        
        // æ³¨æ–‡ç•ªå·ãŒè¦‹ã¤ã‹ã£ã¦ã„ã‚‹å ´åˆã®ã¿ã€ä»–ã®æƒ…å ±ã‚’æ¢ã™
        if (!currentOrder.orderNumber) continue;
        
        // æ•°é‡ã‚’æ¤œå‡ºï¼ˆæ•°å­—ã ã‘ã®è¡Œã€ç©ºç™½ã‚’é™¤å»ï¼‰
        const cleanLine = line.replace(/\s+/g, '');
        if (cleanLine.match(/^\d+$/) && parseInt(cleanLine) > 0 && parseInt(cleanLine) < 100000) {
          if (!currentOrder.quantity) {
            currentOrder.quantity = cleanLine;
            console.log('  ğŸ“¦ æ•°é‡:', cleanLine);
          }
          continue;
        }
        
        // ç´æœŸã‚’æ¤œå‡ºï¼ˆYY/MM/DDå½¢å¼ï¼‰
        if (line.match(/^\d{2}\/\d{2}\/\d{2}$/)) {
          if (!currentOrder.deliveryDate) {
            currentOrder.deliveryDate = '20' + line;
            console.log('  ğŸ“… ç´æœŸ:', '20' + line);
          } else if (!currentOrder.orderDate) {
            currentOrder.orderDate = '20' + line;
            console.log('  ğŸ“… å—æ³¨æ—¥:', '20' + line);
          }
          continue;
        }
        
        // è£½å“åã‚’æ¤œå‡ºï¼ˆæ—¥æœ¬èªã‚’å«ã‚€ï¼‰
        if (line.match(/[ã-ã‚“ã‚¡-ãƒ¶ãƒ¼ä¸€-é¾ ]/) && line.length > 2) {
          // ã€Œå†·å´ã€ã€Œãƒ•ã‚£ãƒ³ã€ã€Œãƒ’ãƒ¼ãƒˆã‚·ãƒ³ã‚¯ã€ãªã©ã‚’å«ã‚€ã‚‚ã®ã€ã¾ãŸã¯éƒ¨é–€åä»¥å¤–
          if (line.match(/å†·å´|ãƒ•ã‚£ãƒ³|ãƒ’ãƒ¼ãƒˆã‚·ãƒ³ã‚¯|PBS|MG\d|HS-|HES|ãƒ¬ã‚¤ã‚­ãƒ£ã‚¯/) && !line.includes('äº‹æ¥­éƒ¨')) {
            if (!currentOrder.productName) {
              currentOrder.productName = line;
              console.log('  ğŸ”§ è£½å“å:', line);
            }
            continue;
          }
        }
        
        // é¡§å®¢åã‚’æ¤œå‡º
        if (line.includes('äº‹æ¥­éƒ¨') || line.includes('ï½´ï¾šï½¸ï¾„ï¾›ï¾†ï½¸ï½½')) {
          if (!currentOrder.customer) {
            currentOrder.customer = line;
            console.log('  ğŸ¢ é¡§å®¢:', line);
          }
          continue;
        }
        
        // å‹ç•ªã‚’æ¤œå‡ºï¼ˆè‹±æ•°å­—ã®çµ„ã¿åˆã‚ã›ï¼‰
        if (line.match(/^[A-Z0-9]+$/) && line.length > 5) {
          if (!currentOrder.productCode) {
            currentOrder.productCode = line;
            console.log('  ğŸ”¤ å‹ç•ª:', line);
          }
          continue;
        }
      }
      
      // æœ€å¾Œã®æ³¨æ–‡ã‚’è¿½åŠ 
      if (currentOrder.orderNumber && currentOrder.productName && currentOrder.quantity) {
        parsedData.push(currentOrder);
        console.log('âœ… æ³¨æ–‡ã‚’ä¿å­˜:', currentOrder.orderNumber);
      }
      
      console.log('');
      console.log('========================================');
      console.log('ğŸ“Š è§£æçµæœ');
      console.log('========================================');
      console.log('æ¤œå‡ºä»¶æ•°:', parsedData.length, 'ä»¶');
      
      // å„æ³¨æ–‡ã®è©³ç´°ã‚’è¡¨ç¤º
      parsedData.forEach((order, index) => {
        console.log(`\næ³¨æ–‡ ${index + 1}:`);
        console.log('  æ³¨æ–‡ç•ªå·:', order.orderNumber);
        console.log('  è£½å“å:', order.productName || '(æœªæ¤œå‡º)');
        console.log('  æ•°é‡:', order.quantity || '(æœªæ¤œå‡º)');
        console.log('  ç´æœŸ:', order.deliveryDate || '(æœªæ¤œå‡º)');
        console.log('  é¡§å®¢:', order.customer || '(æœªæ¤œå‡º)');
      });
      
      console.log('========================================');
      
      if (parsedData.length === 0) {
        alert('âŒ ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚\n\nF12ã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚\n\nå‡¦ç†ã—ãŸè¡Œæ•°: ' + lines.length);
        return;
      }
      
      // ä¸å®Œå…¨ãªãƒ‡ãƒ¼ã‚¿ã®è­¦å‘Š
      const incompleteOrders = parsedData.filter(order => 
        !order.productName || !order.quantity || !order.deliveryDate
      );
      
      if (incompleteOrders.length > 0) {
        console.warn('âš ï¸ ä¸å®Œå…¨ãªãƒ‡ãƒ¼ã‚¿:', incompleteOrders.length, 'ä»¶');
        incompleteOrders.forEach(order => {
          console.warn('  æ³¨æ–‡ç•ªå·:', order.orderNumber);
          if (!order.productName) console.warn('    â†’ è£½å“åãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
          if (!order.quantity) console.warn('    â†’ æ•°é‡ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
          if (!order.deliveryDate) console.warn('    â†’ ç´æœŸãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
        });
      }
      
      setCsvPreviewData(parsedData);
      setShowImportModal(true);
      setShowPasteArea(false);
      setPastedText('');
      
    } catch (error) {
      console.error('âŒ ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ:', error);
      console.error('ã‚¨ãƒ©ãƒ¼è©³ç´°:', error.message);
      console.error('ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹:', error.stack);
      alert('ãƒ‡ãƒ¼ã‚¿ã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸã€‚\n\nã‚¨ãƒ©ãƒ¼: ' + error.message + '\n\nF12ã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
    }
  };

  const confirmImport = async () => {
    setIsProcessing(true);
    
    try {
      const newOrders = csvPreviewData.map(data => ({
        id: Date.now().toString() + Math.random().toString(36).substr(2, 9),
        productName: data.productName || 'è£½å“åãªã—',
        customerName: data.customer || 'ï½´ï¾šï½¸ï¾„ï¾›ï¾†ï½¸ï½½äº‹æ¥­éƒ¨',
        quantity: data.quantity || '',
        unit: 'å€‹',
        orderDate: data.orderDate || '',
        deliveryDate: data.deliveryDate || '',
        status: data.status || 'å—æ³¨',
        notes: `æ³¨æ–‡ç•ªå·: ${data.orderNumber}${data.productCode ? '\nå‹ç•ª: ' + data.productCode : ''}`,
        createdAt: new Date().toISOString(),
        updatedAt: new Date().toISOString()
      }));
      
      await saveOrders([...orders, ...newOrders]);
      setShowImportModal(false);
      setCsvPreviewData([]);
      alert(`âœ… ${newOrders.length}ä»¶ã®æ³¨æ–‡ã‚’ç™»éŒ²ã—ã¾ã—ãŸï¼`);
    } catch (error) {
      console.error('ç™»éŒ²ã‚¨ãƒ©ãƒ¼:', error);
      alert('ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
    } finally {
      setIsProcessing(false);
    }
  };

  const handleMaterialSubmit = () => {
    if (!materialForm.name || !materialForm.quantity) {
      alert('ææ–™åã¨æ•°é‡ã¯å¿…é ˆã§ã™');
      return;
    }

    if (editingId) {
      const updated = materials.map(m => 
        m.id === editingId ? { ...materialForm, id: editingId, updatedAt: new Date().toISOString() } : m
      );
      saveMaterials(updated);
      setEditingId(null);
    } else {
      const newMaterial = {
        ...materialForm,
        id: Date.now().toString(),
        createdAt: new Date().toISOString(),
        updatedAt: new Date().toISOString()
      };
      saveMaterials([...materials, newMaterial]);
    }

    setMaterialForm({ name: '', code: '', quantity: '', unit: 'kg', location: '', minStock: '', notes: '' });
    setShowAddForm(false);
  };

  const handleOrderSubmit = () => {
    if (!orderForm.productName || !orderForm.deliveryDate) {
      alert('è£½å“åã¨ç´æœŸã¯å¿…é ˆã§ã™');
      return;
    }

    if (editingId) {
      const updated = orders.map(o => 
        o.id === editingId ? { ...orderForm, id: editingId, updatedAt: new Date().toISOString() } : o
      );
      saveOrders(updated);
      setEditingId(null);
    } else {
      const newOrder = {
        ...orderForm,
        id: Date.now().toString(),
        createdAt: new Date().toISOString(),
        updatedAt: new Date().toISOString()
      };
      saveOrders([...orders, newOrder]);
    }

    setOrderForm({ productName: '', customerName: '', quantity: '', unit: 'å€‹', orderDate: '', deliveryDate: '', status: 'è£½é€ ä¸­', notes: '' });
    setShowAddForm(false);
  };

  const handleMaterialEdit = (material) => {
    setMaterialForm(material);
    setEditingId(material.id);
    setShowAddForm(true);
  };

  const handleOrderEdit = (order) => {
    setOrderForm(order);
    setEditingId(order.id);
    setShowAddForm(true);
  };

  const handleMaterialDelete = (id) => {
    if (confirm('ã“ã®ææ–™ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
      saveMaterials(materials.filter(m => m.id !== id));
    }
  };

  const handleOrderDelete = (id) => {
    if (confirm('ã“ã®æ³¨æ–‡ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
      saveOrders(orders.filter(o => o.id !== id));
    }
  };

  const handleCancel = () => {
    setMaterialForm({ name: '', code: '', quantity: '', unit: 'kg', location: '', minStock: '', notes: '' });
    setOrderForm({ productName: '', customerName: '', quantity: '', unit: 'å€‹', orderDate: '', deliveryDate: '', status: 'è£½é€ ä¸­', notes: '' });
    setEditingId(null);
    setShowAddForm(false);
  };

  const filteredMaterials = materials.filter(m =>
    m.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
    m.code.toLowerCase().includes(searchTerm.toLowerCase()) ||
    m.location.toLowerCase().includes(searchTerm.toLowerCase())
  );

  const filteredOrders = orders.filter(o =>
    o.productName.toLowerCase().includes(searchTerm.toLowerCase()) ||
    o.customerName.toLowerCase().includes(searchTerm.toLowerCase())
  );

  const lowStockItems = materials.filter(m => 
    m.minStock && parseFloat(m.quantity) <= parseFloat(m.minStock)
  );

  const getDeliveryStatus = (deliveryDate) => {
    if (!deliveryDate) return 'normal';
    const today = new Date();
    const delivery = new Date(deliveryDate);
    const daysUntil = Math.ceil((delivery - today) / (1000 * 60 * 60 * 24));
    
    if (daysUntil < 0) return 'overdue';
    if (daysUntil <= 3) return 'urgent';
    if (daysUntil <= 7) return 'soon';
    return 'normal';
  };

  const urgentOrders = orders.filter(o => {
    const status = getDeliveryStatus(o.deliveryDate);
    return o.status !== 'å®Œäº†' && (status === 'urgent' || status === 'overdue');
  });

  const formatDate = (dateString) => {
    if (!dateString) return '-';
    const date = new Date(dateString);
    return `${date.getMonth() + 1}/${date.getDate()}`;
  };

  const formatTime = (date) => {
    if (!date) return '';
    const d = new Date(date);
    return `${d.getHours()}:${String(d.getMinutes()).padStart(2, '0')}`;
  };

  const getDeliveryBadge = (deliveryDate, status) => {
    if (status === 'å®Œäº†') {
      return (
        <span className="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
          <CheckCircle size={12} className="mr-1" />
          å®Œäº†
        </span>
      );
    }

    const deliveryStatus = getDeliveryStatus(deliveryDate);
    
    if (deliveryStatus === 'overdue') {
      return (
        <span className="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800">
          <AlertCircle size={12} className="mr-1" />
          ç´æœŸè¶…é
        </span>
      );
    } else if (deliveryStatus === 'urgent') {
      return (
        <span className="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-800">
          <Clock size={12} className="mr-1" />
          3æ—¥ä»¥å†…
        </span>
      );
    } else if (deliveryStatus === 'soon') {
      return (
        <span className="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
          <Clock size={12} className="mr-1" />
          1é€±é–“ä»¥å†…
        </span>
      );
    }
    
    return (
      <span className="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
        ä½™è£•ã‚ã‚Š
      </span>
    );
  };

  return (
    <div className="min-h-screen bg-gray-50 p-4">
      <div className="max-w-6xl mx-auto">
        <header className="bg-blue-600 text-white p-6 rounded-lg shadow-lg mb-6">
          <div className="flex justify-between items-start mb-3">
            <div>
              <h1 className="text-3xl font-bold mb-2">ãƒ’ãƒ¼ãƒˆã‚·ãƒ³ã‚¯è£½é€  ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </h1>
              <p className="text-blue-100">åœ¨åº«ç®¡ç†ãƒ»ç´æœŸç®¡ç†ã®çµ±åˆã‚·ã‚¹ãƒ†ãƒ ï¼ˆã‚¯ãƒ©ã‚¦ãƒ‰å…±æœ‰ç‰ˆï¼‰</p>
            </div>
            <button
              onClick={() => setShowSettings(!showSettings)}
              className="bg-blue-700 hover:bg-blue-800 text-white px-4 py-2 rounded-lg flex items-center gap-2"
            >
              <Bell size={20} />
              é€šçŸ¥è¨­å®š
            </button>
          </div>
          
          <div className="flex items-center gap-4 text-sm flex-wrap">
            <div className="flex items-center gap-2 bg-blue-700 px-3 py-1 rounded">
              <Cloud size={16} />
              <span className={syncStatus === 'åŒæœŸæ¸ˆã¿' ? 'text-green-200' : syncStatus === 'åŒæœŸä¸­...' ? 'text-yellow-200' : 'text-red-200'}>
                {syncStatus}
              </span>
            </div>
            {lastSync && (
              <div className="text-blue-200 text-xs">
                æœ€çµ‚åŒæœŸ: {formatTime(lastSync)}
              </div>
            )}
            <button
              onClick={loadData}
              className="bg-blue-700 hover:bg-blue-800 px-3 py-1 rounded flex items-center gap-1"
            >
              <RefreshCw size={14} />
              æ‰‹å‹•æ›´æ–°
            </button>
          </div>
          
          <div className="mt-4 flex gap-3 flex-wrap">
            <button
              onClick={() => {
                console.log('ğŸŸ¢ ç·‘ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ï¼');
                setShowPasteArea(true);
              }}
              className="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg inline-flex items-center gap-2 font-bold shadow-lg transition-all hover:shadow-xl"
            >
              <Upload size={20} />
              ğŸ“‹ eå•†è²·ãƒ‡ãƒ¼ã‚¿ã‚’ç›´æ¥è²¼ã‚Šä»˜ã‘ï¼ˆæ¨å¥¨ï¼‰
            </button>
            
            <label htmlFor="csv-upload" className="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg inline-flex items-center gap-2 font-bold shadow-lg cursor-pointer transition-all hover:shadow-xl">
              <Upload size={20} />
              ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰èª­ã¿è¾¼ã¿
            </label>
            <input
              id="csv-upload"
              type="file"
              accept=".txt,.csv,text/plain"
              onChange={handleFileSelect}
              className="hidden"
            />
          </div>
          
          {showPasteArea && (
            <div className="mt-4 bg-white border-2 border-green-500 rounded-lg p-4">
              <h3 className="text-lg font-bold text-green-900 mb-2">ğŸ“‹ eå•†è²·ã®ãƒ‡ãƒ¼ã‚¿ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„</h3>
              <p className="text-sm text-gray-600 mb-3">
                eå•†è²·ã®å—æ³¨ä¸€è¦§ã‚’ã‚³ãƒ”ãƒ¼ï¼ˆCtrl+Cï¼‰ã—ã¦ã€ä¸‹ã®ãƒœãƒƒã‚¯ã‚¹ã«è²¼ã‚Šä»˜ã‘ï¼ˆCtrl+Vï¼‰ã—ã¦ãã ã•ã„
              </p>
              <div className="bg-yellow-50 border-l-4 border-yellow-400 p-3 mb-3">
                <p className="text-sm text-yellow-800">
                  ğŸ’¡ <strong>ãƒ’ãƒ³ãƒˆ:</strong> ãƒ‡ãƒ¼ã‚¿é‡ãŒå¤šã„å ´åˆã€å‡¦ç†ã«æ•°ç§’ã‹ã‹ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚
                  ã€Œâœ“ ç™»éŒ²ã™ã‚‹ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸã‚‰ã€F12ã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’è¦‹ã¦ãã ã•ã„ã€‚
                </p>
              </div>
              <textarea
                className="w-full h-48 p-3 border-2 border-gray-300 rounded-lg font-mono text-sm focus:border-green-500 focus:ring-2 focus:ring-green-200 bg-white text-gray-900"
                style={{ color: '#000000', backgroundColor: '#ffffff' }}
                placeholder="ã“ã“ã« eå•†è²·ã®å—æ³¨ãƒ‡ãƒ¼ã‚¿ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„...&#10;&#10;ä¾‹ï¼š&#10;125OR0007137&#10;å¤‰æ›´&#10;MG24N001H1010&#10;63&#10;å€‹&#10;25/10/23&#10;å†·å´ãƒ•ã‚£ãƒ³&#10;ï½´ï¾šï½¸ï¾„ï¾›ï¾†ï½¸ï½½äº‹æ¥­éƒ¨&#10;..."
                value={pastedText}
                onChange={(e) => setPastedText(e.target.value)}
              />
              <div className="flex gap-3 mt-3">
                <button
                  onClick={handlePasteImport}
                  disabled={isProcessing}
                  className="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg font-bold disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center gap-2"
                >
                  {isProcessing ? (
                    <>
                      <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-white"></div>
                      å‡¦ç†ä¸­...
                    </>
                  ) : (
                    <>âœ“ ç™»éŒ²ã™ã‚‹</>
                  )}
                </button>
                <button
                  onClick={() => {setShowPasteArea(false); setPastedText('');}}
                  disabled={isProcessing}
                  className="bg-gray-300 hover:bg-gray-400 text-gray-700 px-6 py-2 rounded-lg font-bold disabled:bg-gray-200"
                >
                  ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                </button>
                {pastedText && (
                  <div className="text-sm text-gray-600 flex items-center">
                    ğŸ“Š {pastedText.length.toLocaleString()} æ–‡å­—
                  </div>
                )}
              </div>
            </div>
          )}
        </header>

        {showImportModal && (
          <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
            <div className="bg-white rounded-lg shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-hidden">
              <div className="bg-green-600 text-white p-4 flex justify-between items-center">
                <h2 className="text-xl font-bold">âœ… {csvPreviewData.length}ä»¶ã®ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ</h2>
                <button onClick={() => setShowImportModal(false)} className="text-white hover:text-gray-200">
                  <X size={24} />
                </button>
              </div>
              
              <div className="p-6 overflow-y-auto max-h-[70vh]">
                <div className="mb-4 bg-green-50 border border-green-200 p-4 rounded">
                  <p className="text-green-800 font-medium">
                    å†…å®¹ã‚’ç¢ºèªã—ã¦ã€ã€Œä¸€æ‹¬ç™»éŒ²ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚
                  </p>
                </div>
                
                <div className="overflow-x-auto">
                  <table className="w-full border-collapse text-sm">
                    <thead className="bg-gray-100">
                      <tr>
                        <th className="border px-3 py-2 text-left">æ³¨æ–‡ç•ªå·</th>
                        <th className="border px-3 py-2 text-left">è£½å“å</th>
                        <th className="border px-3 py-2 text-right">æ•°é‡</th>
                        <th className="border px-3 py-2 text-left">ç´æœŸ</th>
                        <th className="border px-3 py-2 text-left">é¡§å®¢</th>
                      </tr>
                    </thead>
                    <tbody>
                      {csvPreviewData.map((data, index) => (
                        <tr key={index} className={index % 2 === 0 ? 'bg-white' : 'bg-gray-50'}>
                          <td className="border px-3 py-2 font-mono text-xs">{data.orderNumber}</td>
                          <td className="border px-3 py-2">{data.productName || '(æœªæ¤œå‡º)'}</td>
                          <td className="border px-3 py-2 text-right font-bold">{data.quantity || '(æœªæ¤œå‡º)'} å€‹</td>
                          <td className="border px-3 py-2">{data.deliveryDate || '(æœªæ¤œå‡º)'}</td>
                          <td className="border px-3 py-2">{data.customer || '(æœªæ¤œå‡º)'}</td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              </div>
              
              <div className="bg-gray-50 p-4 flex justify-end gap-3">
                <button
                  onClick={() => setShowImportModal(false)}
                  disabled={isProcessing}
                  className="bg-gray-300 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-400 font-medium disabled:bg-gray-200"
                >
                  ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                </button>
                <button
                  onClick={confirmImport}
                  disabled={isProcessing}
                  className="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 font-bold flex items-center gap-2 disabled:bg-gray-400"
                >
                  {isProcessing ? (
                    <>
                      <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-white"></div>
                      ç™»éŒ²ä¸­...
                    </>
                  ) : (
                    <>
                      <CheckCircle size={18} />
                      ä¸€æ‹¬ç™»éŒ² ({csvPreviewData.length}ä»¶)
                    </>
                  )}
                </button>
              </div>
            </div>
          </div>
        )}

        {showSettings && (
          <div className="bg-white rounded-lg shadow-lg p-6 mb-6 border-2 border-blue-300">
            <h2 className="text-2xl font-bold mb-4 text-gray-800 flex items-center gap-2">
              <Mail size={24} />
              ãƒ¡ãƒ¼ãƒ«é€šçŸ¥è¨­å®š
            </h2>
            
            <div className="mb-6">
              <label className="block text-sm font-medium text-gray-700 mb-2">
                ã‚ãªãŸã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆä»»æ„ï¼‰
              </label>
              <input
                type="email"
                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                value={userEmail}
                onChange={(e) => setUserEmail(e.target.value)}
                placeholder="your.email@example.com"
              />
            </div>

            <div className="mb-4">
              <label className="block text-sm font-medium text-gray-700 mb-2">
                é€šçŸ¥ã‚’å—ã‘å–ã‚‹ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆå…¨å“¡ã§å…±æœ‰ï¼‰
              </label>
              <div className="flex gap-2 mb-3">
                <input
                  type="email"
                  className="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                  value={newEmail}
                  onChange={(e) => setNewEmail(e.target.value)}
                  placeholder="member@example.com"
                  onKeyPress={(e) => e.key === 'Enter' && addNotificationEmail()}
                />
                <button
                  onClick={addNotificationEmail}
                  className="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700"
                >
                  è¿½åŠ 
                </button>
              </div>

              {notificationEmails.length > 0 && (
                <div className="space-y-2">
                  {notificationEmails.map((email, index) => (
                    <div key={index} className="flex items-center justify-between bg-gray-50 p-3 rounded-lg">
                      <span className="text-gray-700">{email}</span>
                      <button
                        onClick={() => removeNotificationEmail(email)}
                        className="text-red-600 hover:text-red-800"
                      >
                        <X size={18} />
                      </button>
                    </div>
                  ))}
                </div>
              )}
            </div>

            <div className="flex gap-3">
              <button
                onClick={saveSettings}
                className="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700"
              >
                è¨­å®šã‚’ä¿å­˜
              </button>
              <button
                onClick={() => setShowSettings(false)}
                className="bg-gray-300 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-400"
              >
                é–‰ã˜ã‚‹
              </button>
            </div>
          </div>
        )}

        {(lowStockItems.length > 0 || urgentOrders.length > 0) && (
          <div className="space-y-3 mb-6">
            {lowStockItems.length > 0 && (
              <div className="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded">
                <div className="flex items-center">
                  <AlertCircle className="text-yellow-600 mr-3" size={24} />
                  <div>
                    <h3 className="font-bold text-yellow-800">åœ¨åº«è­¦å‘Š</h3>
                    <p className="text-yellow-700">
                      {lowStockItems.length}ä»¶ã®ææ–™ãŒæœ€å°åœ¨åº«ã‚’ä¸‹å›ã£ã¦ã„ã¾ã™
                    </p>
                  </div>
                </div>
              </div>
            )}
            {urgentOrders.length > 0 && (
              <div className="bg-red-50 border-l-4 border-red-400 p-4 rounded">
                <div className="flex items-center">
                  <Clock className="text-red-600 mr-3" size={24} />
                  <div>
                    <h3 className="font-bold text-red-800">ç´æœŸè­¦å‘Š</h3>
                    <p className="text-red-700">
                      {urgentOrders.length}ä»¶ã®æ³¨æ–‡ãŒç´æœŸé–“è¿‘ã¾ãŸã¯ç´æœŸåˆ‡ã‚Œã§ã™
                    </p>
                  </div>
                </div>
              </div>
            )}
          </div>
        )}

        <div className="bg-white rounded-lg shadow-md mb-6">
          <div className="border-b border-gray-200">
            <div className="flex">
              <button
                onClick={() => { setActiveTab('materials'); setShowAddForm(false); setSearchTerm(''); }}
                className={`flex-1 px-6 py-4 font-bold text-lg ${
                  activeTab === 'materials'
                    ? 'text-blue-600 border-b-2 border-blue-600 bg-blue-50'
                    : 'text-gray-600 hover:bg-gray-50'
                }`}
              >
                <Package className="inline mr-2" size={20} />
                åœ¨åº«ç®¡ç†
              </button>
              <button
                onClick={() => { setActiveTab('orders'); setShowAddForm(false); setSearchTerm(''); }}
                className={`flex-1 px-6 py-4 font-bold text-lg ${
                  activeTab === 'orders'
                    ? 'text-blue-600 border-b-2 border-blue-600 bg-blue-50'
                    : 'text-gray-600 hover:bg-gray-50'
                }`}
              >
                <Calendar className="inline mr-2" size={20} />
                ç´æœŸç®¡ç†
              </button>
            </div>
          </div>

          <div className="p-6">
            <div className="flex flex-col md:flex-row gap-4 mb-4">
              <div className="flex-1 relative">
                <Search className="absolute left-3 top-3 text-gray-400" size={20} />
                <input
                  type="text"
                  placeholder={activeTab === 'materials' ? 'ææ–™åã€å“ç•ªã€ä¿ç®¡å ´æ‰€ã§æ¤œç´¢...' : 'è£½å“åã€é¡§å®¢åã§æ¤œç´¢...'}
                  className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  value={searchTerm}
                  onChange={(e) => setSearchTerm(e.target.value)}
                />
              </div>
              <button
                onClick={() => setShowAddForm(!showAddForm)}
                className="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 flex items-center justify-center gap-2 font-medium"
              >
                <Plus size={20} />
                {activeTab === 'materials' ? 'ææ–™ã‚’è¿½åŠ ' : 'æ³¨æ–‡ã‚’è¿½åŠ '}
              </button>
            </div>

            {activeTab === 'materials' && showAddForm && (
              <div className="bg-gray-50 p-6 rounded-lg mb-6 border-2 border-blue-200">
                <h3 className="text-xl font-bold mb-4 text-gray-800">
                  {editingId ? 'ææ–™ã‚’ç·¨é›†' : 'æ–°è¦ææ–™ã‚’è¿½åŠ '}
                </h3>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">
                      ææ–™å <span className="text-red-500">*</span>
                    </label>
                    <input
                      type="text"
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      value={materialForm.name}
                      onChange={(e) => setMaterialForm({...materialForm, name: e.target.value})}
                      placeholder="ä¾‹: A5052 ã‚¢ãƒ«ãƒŸæ¿"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">å“ç•ªãƒ»å‹ç•ª</label>
                    <input
                      type="text"
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      value={materialForm.code}
                      onChange={(e) => setMaterialForm({...materialForm, code: e.target.value})}
                      placeholder="ä¾‹: AL-5052-100"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">
                      æ•°é‡ <span className="text-red-500">*</span>
                    </label>
                    <input
                      type="number"
                      step="0.01"
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      value={materialForm.quantity}
                      onChange={(e) => setMaterialForm({...materialForm, quantity: e.target.value})}
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">å˜ä½</label>
                    <select
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      value={materialForm.unit}
                      onChange={(e) => setMaterialForm({...materialForm, unit: e.target.value})}
                    >
                      <option value="kg">kg</option>
                      <option value="æš">æš</option>
                      <option value="æœ¬">æœ¬</option>
                      <option value="å€‹">å€‹</option>
                      <option value="m">m</option>
                    </select>
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">ä¿ç®¡å ´æ‰€</label>
                    <input
                      type="text"
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      value={materialForm.location}
                      onChange={(e) => setMaterialForm({...materialForm, location: e.target.value})}
                      placeholder="ä¾‹: Aæ£Ÿ-æ£š2-ä¸Šæ®µ"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">æœ€å°åœ¨åº«é‡</label>
                    <input
                      type="number"
                      step="0.01"
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      value={materialForm.minStock}
                      onChange={(e) => setMaterialForm({...materialForm, minStock: e.target.value})}
                      placeholder="ã“ã®æ•°å€¤ä»¥ä¸‹ã§è­¦å‘Š"
                    />
                  </div>
                  <div className="md:col-span-2">
                    <label className="block text-sm font-medium text-gray-700 mb-1">å‚™è€ƒ</label>
                    <textarea
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      rows="2"
                      value={materialForm.notes}
                      onChange={(e) => setMaterialForm({...materialForm, notes: e.target.value})}
                      placeholder="ç‰¹è¨˜äº‹é …ãªã©"
                    />
                  </div>
                </div>
                <div className="flex gap-3 mt-4">
                  <button
                    onClick={handleMaterialSubmit}
                    className="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 flex items-center gap-2"
                  >
                    <Save size={18} />
                    {editingId ? 'æ›´æ–°' : 'ç™»éŒ²'}
                  </button>
                  <button
                    onClick={handleCancel}
                    className="bg-gray-300 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-400 flex items-center gap-2"
                  >
                    <X size={18} />
                    ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                  </button>
                </div>
              </div>
            )}

            {activeTab === 'orders' && showAddForm && (
              <div className="bg-gray-50 p-6 rounded-lg mb-6 border-2 border-blue-200">
                <h3 className="text-xl font-bold mb-4 text-gray-800">
                  {editingId ? 'æ³¨æ–‡ã‚’ç·¨é›†' : 'æ–°è¦æ³¨æ–‡ã‚’è¿½åŠ '}
                </h3>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">
                      è£½å“å <span className="text-red-500">*</span>
                    </label>
                    <input
                      type="text"
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      value={orderForm.productName}
                      onChange={(e) => setOrderForm({...orderForm, productName: e.target.value})}
                      placeholder="ä¾‹: CPUç”¨ãƒ’ãƒ¼ãƒˆã‚·ãƒ³ã‚¯ HS-500"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">é¡§å®¢å</label>
                    <input
                      type="text"
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      value={orderForm.customerName}
                      onChange={(e) => setOrderForm({...orderForm, customerName: e.target.value})}
                      placeholder="ä¾‹: æ ªå¼ä¼šç¤¾â—‹â—‹"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">æ•°é‡</label>
                    <input
                      type="number"
                      step="1"
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      value={orderForm.quantity}
                      onChange={(e) => setOrderForm({...orderForm, quantity: e.target.value})}
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">å˜ä½</label>
                    <select
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      value={orderForm.unit}
                      onChange={(e) => setOrderForm({...orderForm, unit: e.target.value})}
                    >
                      <option value="å€‹">å€‹</option>
                      <option value="ã‚»ãƒƒãƒˆ">ã‚»ãƒƒãƒˆ</option>
                      <option value="ãƒ­ãƒƒãƒˆ">ãƒ­ãƒƒãƒˆ</option>
                    </select>
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">å—æ³¨æ—¥</label>
                    <input
                      type="date"
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      value={orderForm.orderDate}
                      onChange={(e) => setOrderForm({...orderForm, orderDate: e.target.value})}
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">
                      ç´æœŸ <span className="text-red-500">*</span>
                    </label>
                    <input
                      type="date"
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      value={orderForm.deliveryDate}
                      onChange={(e) => setOrderForm({...orderForm, deliveryDate: e.target.value})}
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">çŠ¶æ…‹</label>
                    <select
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      value={orderForm.status}
                      onChange={(e) => setOrderForm({...orderForm, status: e.target.value})}
                    >
                      <option value="å—æ³¨">å—æ³¨</option>
                      <option value="è£½é€ ä¸­">è£½é€ ä¸­</option>
                      <option value="æ¤œæŸ»ä¸­">æ¤œæŸ»ä¸­</option>
                      <option value="å‡ºè·æº–å‚™">å‡ºè·æº–å‚™</option>
                      <option value="å®Œäº†">å®Œäº†</option>
                    </select>
                  </div>
                  <div className="md:col-span-2">
                    <label className="block text-sm font-medium text-gray-700 mb-1">å‚™è€ƒ</label>
                    <textarea
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                      rows="2"
                      value={orderForm.notes}
                      onChange={(e) => setOrderForm({...orderForm, notes: e.target.value})}
                      placeholder="ç‰¹è¨˜äº‹é …ãªã©"
                    />
                  </div>
                </div>
                <div className="flex gap-3 mt-4">
                  <button
                    onClick={handleOrderSubmit}
                    className="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 flex items-center gap-2"
                  >
                    <Save size={18} />
                    {editingId ? 'æ›´æ–°' : 'ç™»éŒ²'}
                  </button>
                  <button
                    onClick={handleCancel}
                    className="bg-gray-300 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-400 flex items-center gap-2"
                  >
                    <X size={18} />
                    ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                  </button>
                </div>
              </div>
            )}
          </div>
        </div>

        {activeTab === 'materials' && (
          <div className="bg-white rounded-lg shadow-md overflow-hidden">
            <div className="p-4 bg-gray-100 border-b">
              <h2 className="text-xl font-bold text-gray-800 flex items-center gap-2">
                <Package size={24} />
                åœ¨åº«ä¸€è¦§ ({filteredMaterials.length}ä»¶)
              </h2>
            </div>
            
            {filteredMaterials.length === 0 ? (
              <div className="p-12 text-center text-gray-500">
                <Package size={48} className="mx-auto mb-4 opacity-50" />
                <p className="text-lg">ç™»éŒ²ã•ã‚ŒãŸææ–™ãŒã‚ã‚Šã¾ã›ã‚“</p>
                <p className="text-sm mt-2">ã€Œææ–™ã‚’è¿½åŠ ã€ãƒœã‚¿ãƒ³ã‹ã‚‰ç™»éŒ²ã—ã¦ãã ã•ã„</p>
              </div>
            ) : (
              <div className="overflow-x-auto">
                <table className="w-full">
                  <thead className="bg-gray-50 border-b-2 border-gray-200">
                    <tr>
                      <th className="px-4 py-3 text-left text-sm font-bold text-gray-700">ææ–™å</th>
                      <th className="px-4 py-3 text-left text-sm font-bold text-gray-700">å“ç•ª</th>
                      <th className="px-4 py-3 text-right text-sm font-bold text-gray-700">æ•°é‡</th>
                      <th className="px-4 py-3 text-left text-sm font-bold text-gray-700">ä¿ç®¡å ´æ‰€</th>
                      <th className="px-4 py-3 text-left text-sm font-bold text-gray-700">çŠ¶æ…‹</th>
                      <th className="px-4 py-3 text-center text-sm font-bold text-gray-700">æ“ä½œ</th>
                    </tr>
                  </thead>
                  <tbody>
                    {filteredMaterials.map((material, index) => {
                      const isLowStock = material.minStock && parseFloat(material.quantity) <= parseFloat(material.minStock);
                      return (
                        <tr key={material.id} className={`border-b hover:bg-gray-50 ${index % 2 === 0 ? 'bg-white' : 'bg-gray-25'}`}>
                          <td className="px-4 py-3">
                            <div className="font-medium text-gray-900">{material.name}</div>
                            {material.notes && <div className="text-xs text-gray-500 mt-1">{material.notes}</div>}
                          </td>
                          <td className="px-4 py-3 text-gray-700">{material.code || '-'}</td>
                          <td className="px-4 py-3 text-right">
                            <span className={`font-bold ${isLowStock ? 'text-red-600' : 'text-gray-900'}`}>
                              {material.quantity}
                            </span>
                            <span className="text-gray-600 ml-1">{material.unit}</span>
                          </td>
                          <td className="px-4 py-3 text-gray-700">{material.location || '-'}</td>
                          <td className="px-4 py-3">
                            {isLowStock ? (
                              <span className="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800">
                                <AlertCircle size={12} className="mr-1" />
                                åœ¨åº«å°‘
                              </span>
                            ) : (
                              <span className="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                æ­£å¸¸
                              </span>
                            )}
                          </td>
                          <td className="px-4 py-3">
                            <div className="flex gap-2 justify-center">
                              <button
                                onClick={() => handleMaterialEdit(material)}
                                className="text-blue-600 hover:text-blue-800 p-1"
                                title="ç·¨é›†"
                              >
                                <Edit2 size={18} />
                              </button>
                              <button
                                onClick={() => handleMaterialDelete(material.id)}
                                className="text-red-600 hover:text-red-800 p-1"
                                title="å‰Šé™¤"
                              >
                                <Trash2 size={18} />
                              </button>
                            </div>
                          </td>
                        </tr>
                      );
                    })}
                  </tbody>
                </table>
              </div>
            )}
          </div>
        )}

        {activeTab === 'orders' && (
          <div className="bg-white rounded-lg shadow-md overflow-hidden">
            <div className="p-4 bg-gray-100 border-b">
              <h2 className="text-xl font-bold text-gray-800 flex items-center gap-2">
                <Calendar size={24} />
                æ³¨æ–‡ä¸€è¦§ ({filteredOrders.length}ä»¶)
              </h2>
            </div>
            
            {filteredOrders.length === 0 ? (
              <div className="p-12 text-center text-gray-500">
                <Calendar size={48} className="mx-auto mb-4 opacity-50" />
                <p className="text-lg">ç™»éŒ²ã•ã‚ŒãŸæ³¨æ–‡ãŒã‚ã‚Šã¾ã›ã‚“</p>
                <p className="text-sm mt-2">ã€Œæ³¨æ–‡ã‚’è¿½åŠ ã€ãƒœã‚¿ãƒ³ã¾ãŸã¯ã€ŒCSVä¸€æ‹¬ç™»éŒ²ã€ã‹ã‚‰ç™»éŒ²ã—ã¦ãã ã•ã„</p>
              </div>
            ) : (
              <div className="overflow-x-auto">
                <table className="w-full">
                  <thead className="bg-gray-50 border-b-2 border-gray-200">
                    <tr>
                      <th className="px-4 py-3 text-left text-sm font-bold text-gray-700">è£½å“å</th>
                      <th className="px-4 py-3 text-left text-sm font-bold text-gray-700">é¡§å®¢å</th>
                      <th className="px-4 py-3 text-right text-sm font-bold text-gray-700">æ•°é‡</th>
                      <th className="px-4 py-3 text-left text-sm font-bold text-gray-700">å—æ³¨æ—¥</th>
                      <th className="px-4 py-3 text-left text-sm font-bold text-gray-700">ç´æœŸ</th>
                      <th className="px-4 py-3 text-left text-sm font-bold text-gray-700">çŠ¶æ…‹</th>
                      <th className="px-4 py-3 text-left text-sm font-bold text-gray-700">ç´æœŸçŠ¶æ³</th>
                      <th className="px-4 py-3 text-center text-sm font-bold text-gray-700">æ“ä½œ</th>
                    </tr>
                  </thead>
                  <tbody>
                    {filteredOrders.map((order, index) => (
                      <tr key={order.id} className={`border-b hover:bg-gray-50 ${index % 2 === 0 ? 'bg-white' : 'bg-gray-25'}`}>
                        <td className="px-4 py-3">
                          <div className="font-medium text-gray-900">{order.productName}</div>
                          {order.notes && <div className="text-xs text-gray-500 mt-1">{order.notes}</div>}
                        </td>
                        <td className="px-4 py-3 text-gray-700">{order.customerName || '-'}</td>
                        <td className="px-4 py-3 text-right">
                          <span className="font-bold text-gray-900">{order.quantity || '-'}</span>
                          {order.quantity && <span className="text-gray-600 ml-1">{order.unit}</span>}
                        </td>
                        <td className="px-4 py-3 text-gray-700">{formatDate(order.orderDate)}</td>
                        <td className="px-4 py-3 text-gray-900 font-medium">{formatDate(order.deliveryDate)}</td>
                        <td className="px-4 py-3">
                          <span className={`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${
                            order.status === 'å®Œäº†' ? 'bg-gray-100 text-gray-800' :
                            order.status === 'å‡ºè·æº–å‚™' ? 'bg-blue-100 text-blue-800' :
                            order.status === 'æ¤œæŸ»ä¸­' ? 'bg-purple-100 text-purple-800' :
                            order.status === 'è£½é€ ä¸­' ? 'bg-yellow-100 text-yellow-800' :
                            'bg-green-100 text-green-800'
                          }`}>
                            {order.status}
                          </span>
                        </td>
                        <td className="px-4 py-3">
                          {getDeliveryBadge(order.deliveryDate, order.status)}
                        </td>
                        <td className="px-4 py-3">
                          <div className="flex gap-2 justify-center">
                            <button
                              onClick={() => handleOrderEdit(order)}
                              className="text-blue-600 hover:text-blue-800 p-1"
                              title="ç·¨é›†"
                            >
                              <Edit2 size={18} />
                            </button>
                            <button
                              onClick={() => handleOrderDelete(order.id)}
                              className="text-red-600 hover:text-red-800 p-1"
                              title="å‰Šé™¤"
                            >
                              <Trash2 size={18} />
                            </button>
                          </div>
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            )}
          </div>
        )}

        <div className="mt-6 bg-green-50 border border-green-200 rounded-lg p-4">
          <h3 className="font-bold text-green-900 mb-2 flex items-center gap-2">
            <Upload size={20} />
            eå•†è²·ãƒ‡ãƒ¼ã‚¿ã®ä¸€æ‹¬ç™»éŒ²æ–¹æ³•ï¼ˆ3ã‚¹ãƒ†ãƒƒãƒ—ï¼‰
          </h3>
          <div className="bg-white border border-green-300 rounded p-3 mb-3">
            <h4 className="font-bold text-green-800 mb-2">âœ… æ–¹æ³•1: ç›´æ¥è²¼ã‚Šä»˜ã‘ï¼ˆæ¨å¥¨ãƒ»ç°¡å˜ï¼ï¼‰</h4>
            <ol className="text-sm text-green-800 space-y-1 list-decimal list-inside">
              <li><strong>eå•†è²·ã®å—æ³¨ä¸€è¦§ã‚’ã‚³ãƒ”ãƒ¼</strong>ï¼ˆãƒã‚¦ã‚¹ã§é¸æŠã—ã¦Ctrl+Cï¼‰</li>
              <li><strong>ç·‘ãƒœã‚¿ãƒ³ã€Œeå•†è²·ãƒ‡ãƒ¼ã‚¿ã‚’ç›´æ¥è²¼ã‚Šä»˜ã‘ã€ã‚’ã‚¯ãƒªãƒƒã‚¯</strong></li>
              <li><strong>è¡¨ç¤ºã•ã‚ŒãŸãƒœãƒƒã‚¯ã‚¹ã«è²¼ã‚Šä»˜ã‘</strong>ï¼ˆCtrl+Vï¼‰â†’ ç™»éŒ²ãƒœã‚¿ãƒ³ â†’ å®Œäº†ï¼</li>
              <li><strong>F12ã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§çµæœã‚’ç¢ºèª</strong></li>
            </ol>
          </div>
          <div className="bg-gray-50 border border-gray-300 rounded p-3">
            <h4 className="font-bold text-gray-800 mb-2">æ–¹æ³•2: ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰èª­ã¿è¾¼ã¿</h4>
            <ol className="text-sm text-gray-700 space-y-1 list-decimal list-inside">
              <li>eå•†è²·ã®å—æ³¨ä¸€è¦§ã‚’ã‚³ãƒ”ãƒ¼ â†’ ãƒ¡ãƒ¢å¸³ã«è²¼ã‚Šä»˜ã‘</li>
              <li>ã€Œå—æ³¨ãƒ‡ãƒ¼ã‚¿.txtã€ã¨ã—ã¦ä¿å­˜</li>
              <li>é’ãƒœã‚¿ãƒ³ã€Œãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰èª­ã¿è¾¼ã¿ã€â†’ ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ â†’ å®Œäº†ï¼</li>
            </ol>
          </div>
        </div>

        <div className="mt-4 bg-blue-50 border border-blue-200 rounded-lg p-4">
          <h3 className="font-bold text-blue-900 mb-2 flex items-center gap-2">
            <Cloud size={20} />
            ã‚¯ãƒ©ã‚¦ãƒ‰å…±æœ‰ã‚·ã‚¹ãƒ†ãƒ 
          </h3>
          <ul className="text-sm text-blue-800 space-y-1">
            <li>â€¢ <strong>è‡ªå‹•åŒæœŸ:</strong> 10ç§’ã”ã¨ã«æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã«æ›´æ–°ã•ã‚Œã¾ã™</li>
            <li>â€¢ <strong>å…¨å“¡ã§å…±æœ‰:</strong> iPhoneã€iPadã€Windowså…¨ã¦ã§åŒã˜ãƒ‡ãƒ¼ã‚¿ã‚’è¦‹ã‚Œã¾ã™</li>
            <li>â€¢ <strong>ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ :</strong> èª°ã‹ãŒç™»éŒ²ã—ãŸã‚‰ã™ãã«åæ˜ ã•ã‚Œã¾ã™</li>
          </ul>
        </div>

        <div className="mt-4 bg-yellow-50 border border-yellow-200 rounded-lg p-4">
          <h3 className="font-bold text-yellow-900 mb-2">ğŸ” ãƒ‡ãƒãƒƒã‚°æ–¹æ³•</h3>
          <p className="text-sm text-yellow-800 mb-2">
            ãƒ‡ãƒ¼ã‚¿ãŒæ­£ã—ãç™»éŒ²ã•ã‚Œãªã„å ´åˆï¼š
          </p>
          <ol className="text-sm text-yellow-800 space-y-1 list-decimal list-inside">
            <li><strong>F12ã‚­ãƒ¼</strong>ã‚’æŠ¼ã—ã¦ã€é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã‚’é–‹ã</li>
            <li><strong>Console</strong>ã‚¿ãƒ–ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
            <li>ãƒ‡ãƒ¼ã‚¿ã‚’è²¼ã‚Šä»˜ã‘ã¦ã€Œâœ“ ç™»éŒ²ã™ã‚‹ã€ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
            <li>ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«è¡¨ç¤ºã•ã‚Œã‚‹æƒ…å ±ã‚’ç¢ºèªï¼š
              <ul className="list-disc list-inside ml-4 mt-1">
                <li>ã€Œæ¤œå‡ºä»¶æ•°: â—‹ä»¶ã€â†’ ä½•ä»¶è¦‹ã¤ã‹ã£ãŸã‹</li>
                <li>å„æ³¨æ–‡ã®è©³ç´°æƒ…å ±</li>
                <li>ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆèµ¤å­—ï¼‰</li>
              </ul>
            </li>
          </ol>
        </div>
      </div>
    </div>
  );
}
